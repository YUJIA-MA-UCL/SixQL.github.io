<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Assessing Urban War Damage in Kharkiv and Mariupol, Ukraine Using Sentinel-1 Imagery</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Assessing Urban War Damage in Kharkiv and Mariupol, Ukraine Using Sentinel-1 Imagery</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/YUJIA-MA-UCL/SixQL.github.io"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text">Open in GitHub</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">




<section id="assessing-urban-war-damage-in-kharkiv-and-mariupol-ukraine-using-sentinel-1-imagery" class="level1 page-columns page-full">
<h1>Assessing Urban War Damage in Kharkiv and Mariupol, Ukraine Using Sentinel-1 Imagery</h1>
<section id="project-summary" class="level2">
<h2 class="anchored" data-anchor-id="project-summary">Project Summary</h2>
<section id="problem-statement" class="level3">
<h3 class="anchored" data-anchor-id="problem-statement">Problem Statement</h3>
<p>What is the problem you’re trying to address using this application?</p>
<p>This application addresses the need for transparent, cost-effective tools to assess infrastructure damage in urban areas affected by the Russia–Ukraine war. It focuses on Kharkiv and Mariupol, the two most affected cities, and estimates building and road damage using a lightweight, unsupervised pixel-wise t-test on freely available Sentinel-1 imagery. Although the war is ongoing, our analysis focuses on the year before and after February 24, 2022, when the full-scale invasion began. Unlike deep learning approaches requiring expensive optical imagery, this method supports repeatable, scalable, and interpretable analysis. The results can assist post-war reconstruction planning, guide humanitarian aid, and inform public understanding of urban destruction patterns in these cities.</p>
</section>
<section id="end-user" class="level3">
<h3 class="anchored" data-anchor-id="end-user">End User</h3>
<p>Who are you building this application for? How does it address a need this community has?</p>
<ul>
<li>Government and planning departments: Initial analyze damage patterns and damage to specific facilities (e.g.&nbsp;housing, hospitals) to prioritise reconstruction and allocate resources effectively.</li>
<li>Humanitarian organisations: Quickly identify severely damaged areas and assess damage to critical infrastructure and residential areas to provide guidance for emergency shelter, public health and logistics planning.</li>
<li>Remote sensing and disaster assessment professionals: Use damage data to validate models, track changes, and compare methods or datasets in disaster impact studies.</li>
<li>Public and media: Explore clear, visual maps of war damage, thereby raising public awareness, and can provide data to support news reporting.</li>
</ul>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>What data are you using?</p>
<ul>
<li><p>Sentinel-1 Imagery<br>
This application uses Sentinel-1 Imagery provided by <a href="https://developers.google.com/earth-engine/guides/sentinel1">Google Earth Engine</a>. To simplify processing and prioritize sensitivity to structural damage, only VH-polarized imagery was used. The data spans February 24, 2020 to February 24, 2023, covering placebo, pre-war, and war phases. From February 2022, imagery was compared monthly to capture temporal changes in damage.</p></li>
<li><p>Building Footprints<br>
Building footprint data is sourced from the <a href="https://docs.overturemaps.org/guides/buildings/#14/32.58453/-117.05154/0/60">Overture Maps Foundation</a>, which combines several open datasets, primarily from OpenStreetMap, Microsoft, and Google Open Buildings. Buildings smaller than 50 m² were excluded due to potential building false positives and the resolution of Sentinel-1.</p></li>
<li><p>Road Networks<br>
The road network data was retrieved from <a href="https://www.openstreetmap.org">OpenStreetMap</a> using the OSMnx package in Python, extracting roads classified as trunk, primary, secondary, and tertiary, and simplifying bidirectional edges.</p></li>
</ul>
</section>
<section id="methodology" class="level3">
<h3 class="anchored" data-anchor-id="methodology">Methodology</h3>
<p>How are you using this data to address the problem?</p>
<p>We used Sentinel-1 SAR imagery to perform a pixel statistical test (t-test) for pre- and post-war changes, identifying potential damage on the map. Overlaying the building footprints and road network data with t-test results to locate and classify damage, and calculate the percentage of damaged buildings and roads, and different subtypes of damaged buildings at 95% confidence intervals. Through monthly monitoring of post-war damages for 12 months after 2022-2-24, the evolution of the war impact will be tracked, and user can select different times to view changes in damages. These features will support urban damage assessment and post-war reconstruction planning.</p>
</section>
<section id="interface" class="level3">
<h3 class="anchored" data-anchor-id="interface">Interface</h3>
<p>How does your application’s interface work to address the needs of your end user?</p>
<p>The application provides clear, visual maps of war damage, enabling the public and researchers in remote sensing and disaster assessment to track the evolution of destruction and the recovery process over time. Layer comparison tools help Ukrainian government and humanitarian organizations visually identify specific areas are affected, supporting resource planning and decision-making for wartime relief and post-disaster reconstruction. The application also calculates the proportion of damaged buildings and roads, and visualizes the distribution of damage across different building types, offering reference statistics for researchers. All users can export damaged building GeoJSON data to conduct urban assessments and make data-driven decisions.</p>
</section>
</section>
<section id="the-application" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="the-application">The Application</h2>
<div class="column-page">
<iframe src="https://ee-yiyaocui.projects.earthengine.app/view/ukraine-buildings-and-roads-damage-assessment" width="100%" height="700px">
</iframe>
</div>
</section>
<section id="how-it-works" class="level2">
<h2 class="anchored" data-anchor-id="how-it-works">How it Works</h2>
<p>Full code can be found <a href="https://code.earthengine.google.com/1d28157046b90fe381378e9c4c2e2a6b?accept_repo=users%2Flittlevivif%2Fsiyuan">here</a>.</p>
<section id="data-input-and-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-input-and-processing">1. Data Input and Processing</h3>
<p>We imported the vector data, including building footprints with building type information and 7.5-meter-wide rectangular road layers, and merged the data from two cities.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- Import Data -----------------------  </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Building footprint</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> buildings_ukr1 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"projects/ee-yiyaocui/assets/ukr1"</span>)<span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> buildings_ukr7 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"projects/ee-yiyaocui/assets/ukr7"</span>)<span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> buildings <span class="op">=</span> buildings_ukr1<span class="op">.</span><span class="fu">merge</span>(buildings_ukr7)<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Roads</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roads_ukr1 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"projects/ee-yiyaocui/assets/osm_ukr1_buffer_50_75_8"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(aoi)<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roads_ukr7 <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"projects/ee-yiyaocui/assets/osm_ukr7_buffer_50_75_14"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(aoi)<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roads <span class="op">=</span> roads_ukr1<span class="op">.</span><span class="fu">merge</span>(roads_ukr7)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, we set up our area of interest (AOI), time range, and map’s centroids. For time range:</p>
<ul>
<li>SHOCK_DATE: 2022-02-24, when Russia launched a full-scale military invasion of Ukraine.</li>
<li>PRE_INTERVAL: 12-month pre-event period (baseline).</li>
<li>POST_INTERVAL: 12-month post-event period (all assessment windows).</li>
</ul>
<p>We defined a updateDateRanges() function to flexibly select an assessment window for the interactive tool.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- Set-up  -----------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">//AOI</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> cityBoundaries <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">"projects/ee-yiyaocui/assets/unosat_aois"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">style</span>({</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">'red'</span><span class="op">,</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fillColor</span><span class="op">:</span> <span class="st">'00000000'</span><span class="op">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> aoi <span class="op">=</span> cityBoundaries<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ukr1 <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Rectangle</span>([<span class="fl">37.46</span><span class="op">,</span> <span class="fl">47.06</span><span class="op">,</span> <span class="fl">37.72</span><span class="op">,</span> <span class="fl">47.16</span>])<span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ukr7 <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Rectangle</span>([<span class="fl">36.09</span><span class="op">,</span> <span class="fl">49.87</span><span class="op">,</span> <span class="fl">36.46</span><span class="op">,</span> <span class="fl">50.11</span>])<span class="op">;</span>  </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> aoi <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>([</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(ukr1)<span class="op">,</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Feature</span>(ukr7)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>])<span class="op">.</span><span class="fu">merge</span>(ee<span class="op">.</span><span class="fu">FeatureCollection</span>([]))<span class="op">.</span><span class="fu">geometry</span>()<span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">//Time </span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> SHOCK_DATE <span class="op">=</span> <span class="st">"2022-02-24"</span><span class="op">;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> PRE_INTERVAL <span class="op">=</span> <span class="dv">12</span><span class="op">;</span>  <span class="co">// month before the event</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> POST_INTERVAL <span class="op">=</span> <span class="dv">12</span><span class="op">;</span> <span class="co">// month after the event</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate precise data filtering range, recalculate when POST_INTERVAL changes</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateDateRanges</span>() {</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> startDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(SHOCK_DATE)<span class="op">.</span><span class="fu">advance</span>(<span class="op">-</span>PRE_INTERVAL<span class="op">,</span> <span class="st">"month"</span>)<span class="op">.</span><span class="fu">format</span>(<span class="st">"YYYY-MM-dd"</span>)<span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> endDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(SHOCK_DATE)<span class="op">.</span><span class="fu">advance</span>(POST_INTERVAL<span class="op">,</span> <span class="st">"month"</span>)<span class="op">.</span><span class="fu">format</span>(<span class="st">"YYYY-MM-dd"</span>)<span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {<span class="dt">startDate</span><span class="op">:</span> startDate<span class="op">,</span> <span class="dt">endDate</span><span class="op">:</span> endDate}<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize date range</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dateRanges <span class="op">=</span> <span class="fu">updateDateRanges</span>()<span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> startDate <span class="op">=</span> dateRanges<span class="op">.</span><span class="at">startDate</span><span class="op">;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> endDate <span class="op">=</span> dateRanges<span class="op">.</span><span class="at">endDate</span><span class="op">;</span> </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Centroid</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(cityBoundaries<span class="op">,</span> <span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Centroid of mariupol </span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mariupolCenter <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">37.59269</span><span class="op">,</span> <span class="fl">47.09966</span>])<span class="op">;</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(mariupolCenter<span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="t-test" class="level3">
<h3 class="anchored" data-anchor-id="t-test">2. T-test</h3>
<p>Based on the tutorial code from CASA0025 Week 9 <em>(Ballinger, O., 2024)</em>, we used the following equation to compute the t-value for each pixel, comparing radar backscatter values before and after the war:</p>
<p><span class="math display">\[ \Large t = {\frac{\overline{x_1}-\overline{x_2}} {\sqrt{\frac{s^2_1}{n_1} + \frac{s^2_2}{n_2}}}} \]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\overline{x_1}\)</span>：mean of the pre-war imagery // code variables: pre-mean</li>
<li><span class="math inline">\(\overline{x_2}\)</span>：mean of the post-war imagery // code variables: post_mean</li>
<li><span class="math inline">\(s_1^2, s_2^2\)</span>：variance of the pre- and post-war data // code variables: pre_sd, post_sd; <span class="math inline">\(s^2\)</span> is implied as <span class="math inline">\(sd^2\)</span></li>
<li><span class="math inline">\(n_1, n_2\)</span>：number of images before and after the war // code variables: pre_n, post_n</li>
</ul>
<p>This approach helps quantify whether observed changes are statistically significant and is particularly useful when ground-truth data is limited. Finally, a t-value greater than 2.5 indicates a significant change at the 99% confidence level.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- TTest function  -----------------------</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">// t-test function (building analysis)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">ttest</span>(s1<span class="op">,</span> shock<span class="op">,</span> pre_interval<span class="op">,</span> post_interval) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Convert event date to ee.Date object</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> shock <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(shock)<span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filter pre-event images: from (shock - pre_interval months) to shock</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pre <span class="op">=</span> s1<span class="op">.</span><span class="fu">filterDate</span>(</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    shock<span class="op">.</span><span class="fu">advance</span>(ee<span class="op">.</span><span class="fu">Number</span>(pre_interval)<span class="op">.</span><span class="fu">multiply</span>(<span class="op">-</span><span class="dv">1</span>)<span class="op">,</span> <span class="st">"month"</span>)<span class="op">,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    shock</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filter post-event images: from shock to (shock + post_interval months)</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> post <span class="op">=</span> s1<span class="op">.</span><span class="fu">filterDate</span>(shock<span class="op">,</span> shock<span class="op">.</span><span class="fu">advance</span>(post_interval<span class="op">,</span> <span class="st">"month"</span>))<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate pre-event mean, standard deviation, and image count</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pre_mean <span class="op">=</span> pre<span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pre_sd <span class="op">=</span> pre<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">stdDev</span>())<span class="op">;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pre_n <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(pre<span class="op">.</span><span class="fu">filterBounds</span>(aoi)<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate post-event mean, standard deviation, and image count</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> post_mean <span class="op">=</span> post<span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> post_sd <span class="op">=</span> post<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">stdDev</span>())<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> post_n <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(post<span class="op">.</span><span class="fu">filterBounds</span>(aoi)<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Print pre and post event image counts for debugging</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">'Pre-event images count: '</span><span class="op">,</span> pre_n)<span class="op">;</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">'Post-event images count: '</span><span class="op">,</span> post_n)<span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate pooled standard deviation</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> pooled_sd <span class="op">=</span> pre_sd</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">multiply</span>(pre_sd)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">multiply</span>(pre_n<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>))</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">add</span>(post_sd<span class="op">.</span><span class="fu">multiply</span>(post_sd)<span class="op">.</span><span class="fu">multiply</span>(post_n<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">1</span>)))</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">divide</span>(pre_n<span class="op">.</span><span class="fu">add</span>(post_n)<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">2</span>))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sqrt</span>()<span class="op">;</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate denominator part of t-test formula</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> denom <span class="op">=</span> pooled_sd<span class="op">.</span><span class="fu">multiply</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    ee<span class="op">.</span><span class="fu">Number</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">divide</span>(pre_n)<span class="op">.</span><span class="fu">add</span>(ee<span class="op">.</span><span class="fu">Number</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">divide</span>(post_n))<span class="op">.</span><span class="fu">sqrt</span>()</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate degrees of freedom (number of observations minus 2)</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> df <span class="op">=</span> pre_n<span class="op">.</span><span class="fu">add</span>(post_n)<span class="op">.</span><span class="fu">subtract</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Number of Images: "</span><span class="op">,</span> df)<span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate t-value: absolute difference of means divided by denominator, minus 2</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> change <span class="op">=</span> post_mean</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">abs</span>()</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">subtract</span>(pre_mean<span class="op">.</span><span class="fu">abs</span>())</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">divide</span>(denom)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">abs</span>()</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">subtract</span>(<span class="fl">2.5</span>)<span class="op">;</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return t-value for each pixel</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> change<span class="op">;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We filter Sentinel-1 radar images by selecting the VH polarization band and the most common orbit number, then separately process ASCENDING and DESCENDING orbits to reduce directional noise. Also, we use NDVI to reduce vegetation disturbance (NDVI &gt; 0.2: vegetation)<em>(Wang, X.&amp;Li, P., 2020; USGS,2018)</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- Satellite Image -----------------------</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Select Sentinel 1 images collection for analysis</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">filter_s1</span>(path) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> s1 <span class="op">=</span> ee</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">"COPERNICUS/S1_GRD"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">listContains</span>(<span class="st">"transmitterReceiverPolarisation"</span><span class="op">,</span> <span class="st">"VH"</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">"instrumentMode"</span><span class="op">,</span> <span class="st">"IW"</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">"orbitProperties_pass"</span><span class="op">,</span> path))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filterBounds</span>(aoi)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filterDate</span>(startDate<span class="op">,</span> endDate)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">select</span>(<span class="st">"VH"</span>)<span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> orbit <span class="op">=</span> s1</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">aggregate_array</span>(<span class="st">"relativeOrbitNumber_start"</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mode</span>())<span class="op">;</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  s1 <span class="op">=</span> s1<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">"relativeOrbitNumber_start"</span><span class="op">,</span> orbit))<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return change in t-value</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> change <span class="op">=</span> <span class="fu">ttest</span>(s1<span class="op">,</span> SHOCK_DATE<span class="op">,</span> PRE_INTERVAL<span class="op">,</span> POST_INTERVAL)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> change<span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">// Select sentinel image for calculation</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ascending_image <span class="op">=</span> <span class="fu">filter_s1</span>(<span class="st">"ASCENDING"</span>)<span class="op">;</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> descending_image <span class="op">=</span> <span class="fu">filter_s1</span>(<span class="st">"DESCENDING"</span>)<span class="op">;</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> asc_des <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>([ascending_image<span class="op">,</span> descending_image])</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>() <span class="co">// use median to reduce impacts of outliers</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">// Add NDVI Mask</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'COPERNICUS/S2_SR'</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(startDate<span class="op">,</span> SHOCK_DATE)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(aoi)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span>([<span class="st">'B4'</span><span class="op">,</span><span class="st">'B8'</span>])</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">median</span>()<span class="op">;</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi <span class="op">=</span> s2<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">'B8'</span><span class="op">,</span><span class="st">'B4'</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">'NDVI'</span>)<span class="op">;</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_mask <span class="op">=</span> ndvi<span class="op">.</span><span class="fu">gt</span>(<span class="fl">0.2</span>)<span class="op">;</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate Composite Image</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> composite_image <span class="op">=</span> asc_des<span class="op">.</span><span class="fu">where</span>(ndvi_mask<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then we overlay the t-test output with building and road layers to estimate the number of damaged buildings and roads in each city. As roads are sensitive to neighboring pixels, we defined damaged roads with at least 50% significant pixels.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- Analysis -----------------------</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Select significant pixel where t-value is positive (99% confidence interval)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> threshold <span class="op">=</span> composite_image<span class="op">.</span><span class="fu">updateMask</span>(composite_image<span class="op">.</span><span class="fu">gt</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Detect damaged buildings and roads</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> damaged_building <span class="op">=</span> threshold<span class="op">.</span><span class="fu">reduceRegions</span>({</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> buildings<span class="op">,</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> damaged_roads <span class="op">=</span> threshold<span class="op">.</span><span class="fu">reduceRegions</span>({</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">collection</span><span class="op">:</span> roads<span class="op">,</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- Calculation -----------------------</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate the number of damaged buildings/roads by cities </span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">//Buildings</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mariupol_buildings <span class="op">=</span> damaged_building<span class="op">.</span><span class="fu">filterBounds</span>(ukr1)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> kharkiv_buildings <span class="op">=</span> damaged_building<span class="op">.</span><span class="fu">filterBounds</span>(ukr7)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> total_buildings <span class="op">=</span> mariupol_buildings<span class="op">.</span><span class="fu">merge</span>(kharkiv_buildings)<span class="op">;</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">//Roads</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mariupol_roads <span class="op">=</span> damaged_roads<span class="op">.</span><span class="fu">filterBounds</span>(ukr1)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> kharkiv_roads <span class="op">=</span> damaged_roads<span class="op">.</span><span class="fu">filterBounds</span>(ukr7)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> total_roads <span class="op">=</span> mariupol_roads<span class="op">.</span><span class="fu">merge</span>(kharkiv_roads)<span class="op">;</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- Visualization -----------------------</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Define color palettes for damaged buildings and roads</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> palette <span class="op">=</span> [<span class="st">"FFFFFF"</span><span class="op">,</span> <span class="st">"3b528b"</span><span class="op">,</span> <span class="st">"21918c"</span><span class="op">,</span> <span class="st">"5ec962"</span><span class="op">,</span> <span class="st">"fde725"</span>]<span class="op">;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> building_palette <span class="op">=</span> [<span class="st">"FFF3D6"</span><span class="op">,</span> <span class="st">"FFDD9E"</span><span class="op">,</span> <span class="st">"FFBE66"</span><span class="op">,</span> <span class="st">"FF9A3D"</span><span class="op">,</span> <span class="st">"FF7519"</span><span class="op">,</span> <span class="st">"FF5100"</span><span class="op">,</span> <span class="st">"FD3000"</span>]<span class="op">;</span> </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------- Layers -----------------------</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">//ttest</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  composite_image<span class="op">,</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette }<span class="op">,</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Buildings Change"</span><span class="op">,</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">false</span>  <span class="co">// Not displayed by default</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co">// Building Footprint Outline</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> empty_buildings <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>()<span class="op">.</span><span class="fu">byte</span>()<span class="op">;</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> buildings_outline <span class="op">=</span> empty_buildings<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="dt">featureCollection</span><span class="op">:</span> damaged_building<span class="op">,</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">"mean"</span><span class="op">,</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="co">// Draw road outline - add white border</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> empty_roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>()<span class="op">.</span><span class="fu">byte</span>()<span class="op">;</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="co">// First create a wider white border</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roads_white_outline <span class="op">=</span> empty_roads<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>  <span class="dt">featureCollection</span><span class="op">:</span> damaged_roads<span class="op">,</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span>  <span class="co">// White</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">9</span>   <span class="co">// Wider than normal width to form a border</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a><span class="co">// Then create normal width colored roads</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roads_outline <span class="op">=</span> empty_roads<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>  <span class="dt">featureCollection</span><span class="op">:</span> damaged_roads<span class="op">,</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">"mean"</span><span class="op">,</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a><span class="co">//  Mapping for checking but displayed by default for user interface design </span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a><span class="co">// Add building outline layer</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  buildings_outline<span class="op">,</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">palette</span><span class="op">:</span> building_palette<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="fl">0.6</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Damaged Buildings"</span><span class="op">,</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  <span class="kw">true</span>  <span class="co">// Displayed by default</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a><span class="co">// First add white border layer</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  roads_white_outline<span class="op">,</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">palette</span><span class="op">:</span> [<span class="st">"ffffff"</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Roads White Outline"</span><span class="op">,</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="kw">false</span>  <span class="co">// Not displayed by default</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a><span class="co">// Then add colored road layer</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  roads_outline<span class="op">,</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">palette</span><span class="op">:</span> building_palette<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="fl">0.6</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Damaged Roads"</span><span class="op">,</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>  <span class="kw">false</span>  <span class="co">// Not displayed by default</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="co">// Add city boundary layer</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(cityBoundaries<span class="op">,</span> {}<span class="op">,</span> <span class="st">'adminboundaries'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="validations-limitations" class="level3">
<h3 class="anchored" data-anchor-id="validations-limitations">3. Validations &amp; Limitations</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Color Icon</th>
<th style="text-align: left;">Color Name</th>
<th style="text-align: left;">Damage Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">🔵</td>
<td style="text-align: left;">Blue</td>
<td style="text-align: left;">No damage</td>
</tr>
<tr class="even">
<td style="text-align: left;">🟢</td>
<td style="text-align: left;">Green</td>
<td style="text-align: left;">Low damage</td>
</tr>
<tr class="odd">
<td style="text-align: left;">🟡🟠</td>
<td style="text-align: left;">Yellow / Orange</td>
<td style="text-align: left;">Medium damage</td>
</tr>
<tr class="even">
<td style="text-align: left;">🔴</td>
<td style="text-align: left;">Red</td>
<td style="text-align: left;">High levels of damage</td>
</tr>
</tbody>
</table>
<section id="placebo-test" class="level4">
<h4 class="anchored" data-anchor-id="placebo-test">3.1. Placebo Test</h4>
<p><img src="https://raw.githubusercontent.com/YUJIA-MA-UCL/SixQL.github.io/refs/heads/main/images/Placebo_Test_1.jpg" class="img-fluid" alt="Placebo_Test_1"> <img src="https://raw.githubusercontent.com/YUJIA-MA-UCL/SixQL.github.io/refs/heads/main/images/Placebo_Test_2.jpg" class="img-fluid" alt="Placebo_Test_2"></p>
<p>The placebo test showed cumulative natural disturbances, stronger and seasonal in Kharkiv, and mainly industrial in Mariupol, with visible improvement after vegetation removal.</p>
</section>
<section id="t-test-image-validation-by-detection" class="level4">
<h4 class="anchored" data-anchor-id="t-test-image-validation-by-detection">3.2. T-Test Image Validation by Detection</h4>
<p>In the t-test evaluations, our method effectively identified large-scale damage to buildings and roads, supported by the prior separation of built-up areas from open green spaces.</p>
<p><img src="https://raw.githubusercontent.com/YUJIA-MA-UCL/SixQL.github.io/refs/heads/main/images/T_Test_1.jpg" class="img-fluid" alt="T_Test_1"> <img src="https://raw.githubusercontent.com/YUJIA-MA-UCL/SixQL.github.io/refs/heads/main/images/T_Test_2.jpg" class="img-fluid" alt="T_Test_2"></p>
<p>In Area A, structural damage was accurately detected without interference from surrounding vegetation; in Area B, major building footprint damage was captured with slight spatial overflow; and in Area C, gaps between adjacent row houses were clearly distinguished. On roads, the model correctly detected heavily damaged sections alongside buildings in Area D, but misclassified a functioning road in Area E as moderately damaged.</p>
</section>
<section id="t-test-image-validation-with-unosat-data" class="level4">
<h4 class="anchored" data-anchor-id="t-test-image-validation-with-unosat-data">3.3. T-Test Image Validation with UNOSAT Data</h4>
<p>In addition, we compared our outcome to UNOSAT Ground truth datasets to validate the model’s performance to detect damaged buildings by spatially interactive matching. <em>(UNOSAT, 2025)</em><br>
<strong>Results</strong><br>
<strong>Table 1: Mariupol with 99% confidence interval</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TP (True Positive)</td>
<td style="text-align: left;">3362</td>
</tr>
<tr class="even">
<td style="text-align: left;">FP (False Positive)</td>
<td style="text-align: left;">5800</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FN (False Negative)</td>
<td style="text-align: left;">1831</td>
</tr>
<tr class="even">
<td style="text-align: left;">TN (True Negative)</td>
<td style="text-align: left;">8695</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Precision</td>
<td style="text-align: left;">0.3670</td>
</tr>
<tr class="even">
<td style="text-align: left;">Recall</td>
<td style="text-align: left;">0.6474</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: left;">0.5999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: left;">0.6124</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F1 Score</td>
<td style="text-align: left;">0.4684</td>
</tr>
</tbody>
</table>
<p><br>
<strong>Table 2: Mariupol with 95% confidence interval</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TP (True Positive)</td>
<td style="text-align: left;">3908</td>
</tr>
<tr class="even">
<td style="text-align: left;">FP (False Positive)</td>
<td style="text-align: left;">7932</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FN (False Negative)</td>
<td style="text-align: left;">1285</td>
</tr>
<tr class="even">
<td style="text-align: left;">TN (True Negative)</td>
<td style="text-align: left;">6563</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Precision</td>
<td style="text-align: left;">0.3301</td>
</tr>
<tr class="even">
<td style="text-align: left;">Recall</td>
<td style="text-align: left;">0.7526</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: left;">0.4528</td>
</tr>
<tr class="even">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: left;">0.5318</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F1 Score</td>
<td style="text-align: left;">0.4589</td>
</tr>
</tbody>
</table>
<p><br>
<strong>Table 3: Kharkiv with 99% confidence interval</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TP (True Positive)</td>
<td style="text-align: left;">689</td>
</tr>
<tr class="even">
<td style="text-align: left;">FP (False Positive)</td>
<td style="text-align: left;">57286</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FN (False Negative)</td>
<td style="text-align: left;">182</td>
</tr>
<tr class="even">
<td style="text-align: left;">TN (True Negative)</td>
<td style="text-align: left;">58532</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Precision</td>
<td style="text-align: left;">0.0119</td>
</tr>
<tr class="even">
<td style="text-align: left;">Recall</td>
<td style="text-align: left;">0.7910</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: left;">0.5054</td>
</tr>
<tr class="even">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: left;">0.5075</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F1 Score</td>
<td style="text-align: left;">0.0234</td>
</tr>
</tbody>
</table>
<p><br>
<strong>Table 4: Kharkiv with 95% confidence interval</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Metric</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TP (True Positive)</td>
<td style="text-align: left;">751</td>
</tr>
<tr class="even">
<td style="text-align: left;">FP (False Positive)</td>
<td style="text-align: left;">72650</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FN (False Negative)</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="even">
<td style="text-align: left;">TN (True Negative)</td>
<td style="text-align: left;">43168</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Precision</td>
<td style="text-align: left;">0.0102</td>
</tr>
<tr class="even">
<td style="text-align: left;">Recall</td>
<td style="text-align: left;">0.8622</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Specificity</td>
<td style="text-align: left;">0.3727</td>
</tr>
<tr class="even">
<td style="text-align: left;">Accuracy</td>
<td style="text-align: left;">0.3764</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F1 Score</td>
<td style="text-align: left;">0.0202</td>
</tr>
</tbody>
</table>
<p>Conclusively, using a 99% confidence interval improved predictive performance. In Mariupol, the F1 score reached 0.4684, demonstrating reasonable effectiveness, while Kharkiv’s F1 score remained low at 0.0234.</p>
<p>Performance limitations were likely linked to natural disturbances, pixel spill-over effects caused by the resolution constraints of 10-metre imagery, temporal mismatches with manual labels due to the cumulative nature of warfare destruction and unclear damage definitions, and missing road footprint and subtype data.</p>
<p>While the method remains valuable for preliminary screening by international organisations, future improvements should prioritize refined preprocessing, clearer damage definitions, multi-temporal validation, and the potential integration of supervised learning techniques to enhance overall accuracy.</p>
</section>
</section>
<section id="user-interface" class="level3">
<h3 class="anchored" data-anchor-id="user-interface">4. User Interface</h3>
<p>The following part is the code for UI design.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ------------------------------------- USER INTERFACE -------------------------------------</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Create left control panel</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> leftPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">position</span><span class="op">:</span> <span class="st">'top-left'</span><span class="op">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">minWidth</span><span class="op">:</span> <span class="st">'290px'</span><span class="op">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="st">'22%'</span><span class="op">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxWidth</span><span class="op">:</span> <span class="st">'500px'</span><span class="op">,</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">maxHeight</span><span class="op">:</span> <span class="st">'88%'</span><span class="op">,</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="st">'auto'</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'vertical'</span><span class="op">,</span> <span class="kw">true</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">// Title panel</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> titlePanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>([</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Ukraine Buildings and Roads Damage Assessment'</span><span class="op">,</span> {</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span><span class="op">,</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'20px'</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Assessing Urban War Damage in Kharkiv and Mariupol, Ukraine Using Sentinel-1 Imagery'</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Add separator line</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> lineBreak <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="st">'1px'</span><span class="op">,</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">backgroundColor</span><span class="op">:</span> <span class="st">'000'</span><span class="op">,</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> <span class="st">'8px 0px 8px 0px'</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co">// Set Mariupol and Kharkiv city center coordinates</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mariupolCenter <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">37.59269</span><span class="op">,</span> <span class="fl">47.09966</span>])<span class="op">;</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> kharkivCenter <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Point</span>([<span class="fl">36.232845</span><span class="op">,</span> <span class="fl">49.988358</span>])<span class="op">;</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="co">// Create city selection dropdown</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> citySelect <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="dt">items</span><span class="op">:</span> [<span class="st">'Mariupol'</span><span class="op">,</span><span class="st">'Kharkiv'</span>]<span class="op">,</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="st">'Mariupol'</span><span class="op">,</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(value) {</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value <span class="op">===</span> <span class="st">'Kharkiv'</span>) {</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(kharkivCenter<span class="op">,</span> <span class="dv">13</span>)<span class="op">;</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (value <span class="op">===</span> <span class="st">'Mariupol'</span>) {</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>      <span class="bu">Map</span><span class="op">.</span><span class="fu">centerObject</span>(mariupolCenter<span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span> <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'center'</span>}</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> cityPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>([</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select City'</span><span class="op">,</span> {</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'16px'</span><span class="op">,</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  citySelect</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="co">// create a time selection panel</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> timePanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'vertical'</span>)<span class="op">,</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">padding</span><span class="op">:</span> <span class="st">'5px 0'</span>}</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>timePanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select Time Period'</span><span class="op">,</span> {</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'16px'</span><span class="op">,</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span><span class="op">,</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'center'</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="co">// create a start date information (fixed value)</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> formattedStartDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(SHOCK_DATE)<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>)<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>timePanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Start Date:'</span> <span class="op">+</span> formattedStartDate <span class="op">+</span><span class="st">' (Fixed)'</span><span class="op">,</span> {</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>  <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'left'</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="co">// create a date picker to select a time interval</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> endDateLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'End Date:'</span><span class="op">,</span> {</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>  <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'left'</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>timePanel<span class="op">.</span><span class="fu">add</span>(endDateLabel)<span class="op">;</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="co">// set up the month interval options</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> intervalOptions <span class="op">=</span> [</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'1 months (2022-03-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">1</span>}<span class="op">,</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'2 months (2022-04-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">2</span>}<span class="op">,</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'3 months (2022-05-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">3</span>}<span class="op">,</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'4 months (2022-06-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">4</span>}<span class="op">,</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'5 months (2022-07-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">5</span>}<span class="op">,</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'6 months (2022-08-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">6</span>}<span class="op">,</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'7 months (2022-09-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">7</span>}<span class="op">,</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'8 months (2022-10-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">8</span>}<span class="op">,</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'9 months (2022-11-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">9</span>}<span class="op">,</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'10 months (2022-12-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">10</span>}<span class="op">,</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'11 months (2023-01-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">11</span>}<span class="op">,</span></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">label</span><span class="op">:</span> <span class="st">'12 months (2023-02-24)'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="dv">12</span>}</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a><span class="co">// create a time interval selection drop-down box</span></span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a><span class="co">// default set the POST_INTERVAL to 1, to compare with the first month</span></span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> POST_INTERVAL <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> intervalSelect <span class="op">=</span> ui<span class="op">.</span><span class="fu">Select</span>({</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>  <span class="dt">items</span><span class="op">:</span> intervalOptions<span class="op">,</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> POST_INTERVAL<span class="op">,</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(value) {</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>    POST_INTERVAL <span class="op">=</span> <span class="bu">Number</span>(value)<span class="op">;</span></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">reanalyzeWithNewInterval</span>()<span class="op">;</span></span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>    <span class="co">// update the left map</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">copyLayersToLeftMap</span>()<span class="op">;</span></span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>    <span class="co">// update the right map</span></span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setRightMapLayers</span>()<span class="op">;</span></span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span>}</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>timePanel<span class="op">.</span><span class="fu">add</span>(intervalSelect)<span class="op">;</span></span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>timePanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select different time periods to view the evolution of war impacts on cities'</span><span class="op">,</span> {</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'11px'</span></span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------</span></span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a><span class="co">// Layer control panel</span></span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> layerPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>  <span class="dt">widgets</span><span class="op">:</span> [</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select Layers'</span><span class="op">,</span> {</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'16px'</span><span class="op">,</span></span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span></span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'vertical'</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">,</span>  <span class="co">// Set to false to disable scrollbar</span></span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">padding</span><span class="op">:</span> <span class="st">'0px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'0px'</span><span class="op">,</span> <span class="dt">maxHeight</span><span class="op">:</span> <span class="st">'none'</span>}  <span class="co">// Ensure no height limit</span></span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a><span class="co">// Get layer by specific name</span></span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getLayerByName</span>(name) {</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> layers <span class="op">=</span> <span class="bu">Map</span><span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">getJsArray</span>()<span class="op">;</span></span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> layers<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (layers[i]<span class="op">.</span><span class="fu">getName</span>() <span class="op">===</span> name) {</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> layers[i]<span class="op">;</span></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a><span class="co">// Create layer checkboxes</span></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> buildingsCheckbox <span class="op">=</span> ui<span class="op">.</span><span class="fu">Checkbox</span>({</span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'Buildings'</span><span class="op">,</span></span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>  <span class="co">// Selected by default</span></span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(isChecked) {</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use name to find layer instead of index</span></span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> layer <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"Damaged Buildings"</span>)<span class="op">;</span></span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (layer) {</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>      layer<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roadsCheckbox <span class="op">=</span> ui<span class="op">.</span><span class="fu">Checkbox</span>({</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'Roads'</span><span class="op">,</span></span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>  <span class="co">// Not selected by default</span></span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(isChecked) {</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Control both road layers simultaneously</span></span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> whiteOutline <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"Roads White Outline"</span>)<span class="op">;</span></span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> roads <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"Damaged Roads"</span>)<span class="op">;</span></span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (whiteOutline) {</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>      whiteOutline<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (roads) {</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>      roads<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ttestCheckbox <span class="op">=</span> ui<span class="op">.</span><span class="fu">Checkbox</span>({</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'T-test Result'</span><span class="op">,</span></span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>  <span class="co">// Not selected by default</span></span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onChange</span><span class="op">:</span> <span class="kw">function</span>(isChecked) {</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> layer <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"T-test Result"</span>)<span class="op">;</span></span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (layer) {</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>      layer<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a><span class="co">// Create a horizontal layout panel to contain checkboxes</span></span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> checkboxPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>  <span class="dt">widgets</span><span class="op">:</span> [buildingsCheckbox<span class="op">,</span> roadsCheckbox<span class="op">,</span> ttestCheckbox]<span class="op">,</span></span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'horizontal'</span>)<span class="op">,</span></span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'4px 0px'</span>}</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a><span class="co">// Add checkbox horizontal panel to layer control panel</span></span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>layerPanel<span class="op">.</span><span class="fu">add</span>(checkboxPanel)<span class="op">;</span></span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a><span class="co">// Create an empty row as separator</span></span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>layerPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">''</span><span class="op">,</span> {<span class="dt">margin</span><span class="op">:</span> <span class="st">'8px 0px'</span>}))<span class="op">;</span></span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a><span class="co">// Create legend function</span></span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">createColorBarPanel</span>() {</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Define color array</span></span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> colors <span class="op">=</span> [<span class="st">"FFF3D6"</span><span class="op">,</span> <span class="st">"FFDD9E"</span><span class="op">,</span> <span class="st">"FFBE66"</span><span class="op">,</span> <span class="st">"FF9A3D"</span><span class="op">,</span> <span class="st">"FF7519"</span><span class="op">,</span> <span class="st">"FF5100"</span><span class="op">,</span> <span class="st">"FD3000"</span>]<span class="op">;</span></span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create color bar parameters</span></span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">makeColorBarParams</span>(palette) {</span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>      <span class="dt">bbox</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="fl">0.1</span>]<span class="op">,</span></span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dimensions</span><span class="op">:</span> <span class="st">"100x10"</span><span class="op">,</span></span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> <span class="st">"png"</span><span class="op">,</span></span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>      <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>      <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>      <span class="dt">palette</span><span class="op">:</span> palette<span class="op">,</span></span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create legend title</span></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> colorBarTitle <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>({</span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">"Damage Probability"</span><span class="op">,</span></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> { <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span> <span class="dt">textAlign</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span> <span class="dt">stretch</span><span class="op">:</span> <span class="st">"horizontal"</span>}<span class="op">,</span></span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-227"><a href="#cb6-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-228"><a href="#cb6-228" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create color bar</span></span>
<span id="cb6-229"><a href="#cb6-229" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> colorBar <span class="op">=</span> ui<span class="op">.</span><span class="fu">Thumbnail</span>({</span>
<span id="cb6-230"><a href="#cb6-230" aria-hidden="true" tabindex="-1"></a>    <span class="dt">image</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Image</span><span class="op">.</span><span class="fu">pixelLonLat</span>()<span class="op">.</span><span class="fu">select</span>(<span class="dv">0</span>)<span class="op">,</span></span>
<span id="cb6-231"><a href="#cb6-231" aria-hidden="true" tabindex="-1"></a>    <span class="dt">params</span><span class="op">:</span> <span class="fu">makeColorBarParams</span>(colors)<span class="op">,</span></span>
<span id="cb6-232"><a href="#cb6-232" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> { <span class="dt">stretch</span><span class="op">:</span> <span class="st">"horizontal"</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">"0px 8px"</span><span class="op">,</span> <span class="dt">maxHeight</span><span class="op">:</span> <span class="st">"24px"</span> }<span class="op">,</span></span>
<span id="cb6-233"><a href="#cb6-233" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-234"><a href="#cb6-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-235"><a href="#cb6-235" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create legend labels</span></span>
<span id="cb6-236"><a href="#cb6-236" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> colorBarLabels <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-237"><a href="#cb6-237" aria-hidden="true" tabindex="-1"></a>    <span class="dt">widgets</span><span class="op">:</span> [</span>
<span id="cb6-238"><a href="#cb6-238" aria-hidden="true" tabindex="-1"></a>      ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Low'</span><span class="op">,</span> { <span class="dt">margin</span><span class="op">:</span> <span class="st">"4px 8px"</span> })<span class="op">,</span></span>
<span id="cb6-239"><a href="#cb6-239" aria-hidden="true" tabindex="-1"></a>      ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">" "</span><span class="op">,</span> {</span>
<span id="cb6-240"><a href="#cb6-240" aria-hidden="true" tabindex="-1"></a>        <span class="dt">margin</span><span class="op">:</span> <span class="st">"4px 8px"</span><span class="op">,</span></span>
<span id="cb6-241"><a href="#cb6-241" aria-hidden="true" tabindex="-1"></a>        <span class="dt">textAlign</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb6-242"><a href="#cb6-242" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stretch</span><span class="op">:</span> <span class="st">"horizontal"</span><span class="op">,</span></span>
<span id="cb6-243"><a href="#cb6-243" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb6-244"><a href="#cb6-244" aria-hidden="true" tabindex="-1"></a>      ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'High'</span><span class="op">,</span> { <span class="dt">margin</span><span class="op">:</span> <span class="st">"4px 8px"</span> })<span class="op">,</span></span>
<span id="cb6-245"><a href="#cb6-245" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb6-246"><a href="#cb6-246" aria-hidden="true" tabindex="-1"></a>    <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">"horizontal"</span>)<span class="op">,</span></span>
<span id="cb6-247"><a href="#cb6-247" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-248"><a href="#cb6-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-249"><a href="#cb6-249" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Combine all elements</span></span>
<span id="cb6-250"><a href="#cb6-250" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> colorBarPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-251"><a href="#cb6-251" aria-hidden="true" tabindex="-1"></a>    <span class="dt">widgets</span><span class="op">:</span> [colorBarTitle<span class="op">,</span> colorBar<span class="op">,</span> colorBarLabels]<span class="op">,</span></span>
<span id="cb6-252"><a href="#cb6-252" aria-hidden="true" tabindex="-1"></a>    <span class="dt">style</span><span class="op">:</span> {<span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">"0px 0px 8px 0px"</span>}</span>
<span id="cb6-253"><a href="#cb6-253" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-254"><a href="#cb6-254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-255"><a href="#cb6-255" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> colorBarPanel<span class="op">;</span></span>
<span id="cb6-256"><a href="#cb6-256" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-257"><a href="#cb6-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-258"><a href="#cb6-258" aria-hidden="true" tabindex="-1"></a><span class="co">// Add color legend to layer panel</span></span>
<span id="cb6-259"><a href="#cb6-259" aria-hidden="true" tabindex="-1"></a>layerPanel<span class="op">.</span><span class="fu">add</span>(<span class="fu">createColorBarPanel</span>())<span class="op">;</span></span>
<span id="cb6-260"><a href="#cb6-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-261"><a href="#cb6-261" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------</span></span>
<span id="cb6-262"><a href="#cb6-262" aria-hidden="true" tabindex="-1"></a><span class="co">// Create assessment panel</span></span>
<span id="cb6-263"><a href="#cb6-263" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> assessPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-264"><a href="#cb6-264" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'vertical'</span>)<span class="op">,</span></span>
<span id="cb6-265"><a href="#cb6-265" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">padding</span><span class="op">:</span> <span class="st">'5px 0'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'5px 0'</span>}</span>
<span id="cb6-266"><a href="#cb6-266" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-267"><a href="#cb6-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-268"><a href="#cb6-268" aria-hidden="true" tabindex="-1"></a><span class="co">// Add title</span></span>
<span id="cb6-269"><a href="#cb6-269" aria-hidden="true" tabindex="-1"></a>assessPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Calculate Damaged Buildings and Roads'</span><span class="op">,</span> {</span>
<span id="cb6-270"><a href="#cb6-270" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'16px'</span><span class="op">,</span></span>
<span id="cb6-271"><a href="#cb6-271" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span></span>
<span id="cb6-272"><a href="#cb6-272" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb6-273"><a href="#cb6-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-274"><a href="#cb6-274" aria-hidden="true" tabindex="-1"></a><span class="co">// Create results display area</span></span>
<span id="cb6-275"><a href="#cb6-275" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> resultsPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-276"><a href="#cb6-276" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'vertical'</span>)<span class="op">,</span></span>
<span id="cb6-277"><a href="#cb6-277" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-278"><a href="#cb6-278" aria-hidden="true" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> <span class="st">'8px 0px'</span><span class="op">,</span></span>
<span id="cb6-279"><a href="#cb6-279" aria-hidden="true" tabindex="-1"></a>    <span class="dt">padding</span><span class="op">:</span> <span class="st">'8px'</span><span class="op">,</span></span>
<span id="cb6-280"><a href="#cb6-280" aria-hidden="true" tabindex="-1"></a>    <span class="dt">border</span><span class="op">:</span> <span class="st">'1px solid #cccccc'</span><span class="op">,</span></span>
<span id="cb6-281"><a href="#cb6-281" aria-hidden="true" tabindex="-1"></a>    <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span></span>
<span id="cb6-282"><a href="#cb6-282" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-283"><a href="#cb6-283" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-284"><a href="#cb6-284" aria-hidden="true" tabindex="-1"></a>resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select a city and click Calculate button to view damage assessment.'</span>))<span class="op">;</span></span>
<span id="cb6-285"><a href="#cb6-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-286"><a href="#cb6-286" aria-hidden="true" tabindex="-1"></a><span class="co">// Create button panel (horizontal layout)</span></span>
<span id="cb6-287"><a href="#cb6-287" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> buttonPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-288"><a href="#cb6-288" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'horizontal'</span>)<span class="op">,</span></span>
<span id="cb6-289"><a href="#cb6-289" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'5px 0'</span>}</span>
<span id="cb6-290"><a href="#cb6-290" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-291"><a href="#cb6-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-292"><a href="#cb6-292" aria-hidden="true" tabindex="-1"></a><span class="co">// Create calculate button</span></span>
<span id="cb6-293"><a href="#cb6-293" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> calculateButton <span class="op">=</span> ui<span class="op">.</span><span class="fu">Button</span>({</span>
<span id="cb6-294"><a href="#cb6-294" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'Calculate'</span><span class="op">,</span></span>
<span id="cb6-295"><a href="#cb6-295" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onClick</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb6-296"><a href="#cb6-296" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculateDamage</span>()<span class="op">;</span></span>
<span id="cb6-297"><a href="#cb6-297" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-298"><a href="#cb6-298" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-299"><a href="#cb6-299" aria-hidden="true" tabindex="-1"></a>    <span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span></span>
<span id="cb6-300"><a href="#cb6-300" aria-hidden="true" tabindex="-1"></a>    <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb6-301"><a href="#cb6-301" aria-hidden="true" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> <span class="st">'5px 2px 5px 0'</span></span>
<span id="cb6-302"><a href="#cb6-302" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-303"><a href="#cb6-303" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-304"><a href="#cb6-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-305"><a href="#cb6-305" aria-hidden="true" tabindex="-1"></a><span class="co">// Create reset button</span></span>
<span id="cb6-306"><a href="#cb6-306" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> resetButton <span class="op">=</span> ui<span class="op">.</span><span class="fu">Button</span>({</span>
<span id="cb6-307"><a href="#cb6-307" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'Reset'</span><span class="op">,</span></span>
<span id="cb6-308"><a href="#cb6-308" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onClick</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb6-309"><a href="#cb6-309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateResultsPanel</span>()<span class="op">;</span></span>
<span id="cb6-310"><a href="#cb6-310" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-311"><a href="#cb6-311" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-312"><a href="#cb6-312" aria-hidden="true" tabindex="-1"></a>    <span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span></span>
<span id="cb6-313"><a href="#cb6-313" aria-hidden="true" tabindex="-1"></a>    <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb6-314"><a href="#cb6-314" aria-hidden="true" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> <span class="st">'5px 0 5px 2px'</span></span>
<span id="cb6-315"><a href="#cb6-315" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-316"><a href="#cb6-316" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-317"><a href="#cb6-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-318"><a href="#cb6-318" aria-hidden="true" tabindex="-1"></a><span class="co">// Add buttons to button panel</span></span>
<span id="cb6-319"><a href="#cb6-319" aria-hidden="true" tabindex="-1"></a>buttonPanel<span class="op">.</span><span class="fu">add</span>(calculateButton)<span class="op">;</span></span>
<span id="cb6-320"><a href="#cb6-320" aria-hidden="true" tabindex="-1"></a>buttonPanel<span class="op">.</span><span class="fu">add</span>(resetButton)<span class="op">;</span></span>
<span id="cb6-321"><a href="#cb6-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-322"><a href="#cb6-322" aria-hidden="true" tabindex="-1"></a><span class="co">// Add button panel and results panel</span></span>
<span id="cb6-323"><a href="#cb6-323" aria-hidden="true" tabindex="-1"></a>assessPanel<span class="op">.</span><span class="fu">add</span>(buttonPanel)<span class="op">;</span></span>
<span id="cb6-324"><a href="#cb6-324" aria-hidden="true" tabindex="-1"></a>assessPanel<span class="op">.</span><span class="fu">add</span>(resultsPanel)<span class="op">;</span></span>
<span id="cb6-325"><a href="#cb6-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-326"><a href="#cb6-326" aria-hidden="true" tabindex="-1"></a><span class="co">// Results displayed in assessment panel</span></span>
<span id="cb6-327"><a href="#cb6-327" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateResultsPanel</span>() {</span>
<span id="cb6-328"><a href="#cb6-328" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb6-329"><a href="#cb6-329" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert EE object to JavaScript string (for UI display)</span></span>
<span id="cb6-330"><a href="#cb6-330" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> formattedEndDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(SHOCK_DATE)<span class="op">.</span><span class="fu">advance</span>(POST_INTERVAL<span class="op">,</span> <span class="st">"month"</span>)<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>)<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-331"><a href="#cb6-331" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-332"><a href="#cb6-332" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Clear results panel</span></span>
<span id="cb6-333"><a href="#cb6-333" aria-hidden="true" tabindex="-1"></a>    resultsPanel<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb6-334"><a href="#cb6-334" aria-hidden="true" tabindex="-1"></a>    resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Select a city and click Calculate button to view damage assessment.'</span>))<span class="op">;</span></span>
<span id="cb6-335"><a href="#cb6-335" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">catch</span> (e) {</span>
<span id="cb6-336"><a href="#cb6-336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">'Error updating results panel:'</span><span class="op">,</span> e)<span class="op">;</span>}</span>
<span id="cb6-337"><a href="#cb6-337" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-338"><a href="#cb6-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-339"><a href="#cb6-339" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate damage</span></span>
<span id="cb6-340"><a href="#cb6-340" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">calculateDamage</span>() {</span>
<span id="cb6-341"><a href="#cb6-341" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get currently selected city</span></span>
<span id="cb6-342"><a href="#cb6-342" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> selectedCity <span class="op">=</span> citySelect<span class="op">.</span><span class="fu">getValue</span>()<span class="op">;</span></span>
<span id="cb6-343"><a href="#cb6-343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-344"><a href="#cb6-344" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Clear results panel and show calculating status</span></span>
<span id="cb6-345"><a href="#cb6-345" aria-hidden="true" tabindex="-1"></a>  resultsPanel<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb6-346"><a href="#cb6-346" aria-hidden="true" tabindex="-1"></a>  resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Calculating...'</span><span class="op">,</span> {</span>
<span id="cb6-347"><a href="#cb6-347" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">'#0034f5'</span></span>
<span id="cb6-348"><a href="#cb6-348" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb6-349"><a href="#cb6-349" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-350"><a href="#cb6-350" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Force UI to render first, then execute calculation using ee.Number's evaluate method</span></span>
<span id="cb6-351"><a href="#cb6-351" aria-hidden="true" tabindex="-1"></a>  ee<span class="op">.</span><span class="fu">Number</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">evaluate</span>(<span class="kw">function</span>() {</span>
<span id="cb6-352"><a href="#cb6-352" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert EE object to JavaScript string (for UI display)</span></span>
<span id="cb6-353"><a href="#cb6-353" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> formattedEndDate<span class="op">;</span></span>
<span id="cb6-354"><a href="#cb6-354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb6-355"><a href="#cb6-355" aria-hidden="true" tabindex="-1"></a>      formattedEndDate <span class="op">=</span> ee<span class="op">.</span><span class="fu">Date</span>(SHOCK_DATE)<span class="op">.</span><span class="fu">advance</span>(POST_INTERVAL<span class="op">,</span> <span class="st">"month"</span>)<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>)<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-356"><a href="#cb6-356" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb6-357"><a href="#cb6-357" aria-hidden="true" tabindex="-1"></a>      formattedEndDate <span class="op">=</span> <span class="st">"Error: Could not format date"</span><span class="op">;</span></span>
<span id="cb6-358"><a href="#cb6-358" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="st">"Error formatting end date:"</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb6-359"><a href="#cb6-359" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-360"><a href="#cb6-360" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-361"><a href="#cb6-361" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get corresponding AOI based on selected city</span></span>
<span id="cb6-362"><a href="#cb6-362" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> cityAOI<span class="op">;</span></span>
<span id="cb6-363"><a href="#cb6-363" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (selectedCity <span class="op">===</span> <span class="st">'Mariupol'</span>) {</span>
<span id="cb6-364"><a href="#cb6-364" aria-hidden="true" tabindex="-1"></a>      cityAOI <span class="op">=</span> ukr1<span class="op">;</span></span>
<span id="cb6-365"><a href="#cb6-365" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (selectedCity <span class="op">===</span> <span class="st">'Kharkiv'</span>) {</span>
<span id="cb6-366"><a href="#cb6-366" aria-hidden="true" tabindex="-1"></a>      cityAOI <span class="op">=</span> ukr7<span class="op">;</span></span>
<span id="cb6-367"><a href="#cb6-367" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-368"><a href="#cb6-368" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-369"><a href="#cb6-369" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb6-370"><a href="#cb6-370" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Filter buildings and roads for current city</span></span>
<span id="cb6-371"><a href="#cb6-371" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> city_buildings <span class="op">=</span> damaged_building<span class="op">.</span><span class="fu">filterBounds</span>(cityAOI)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-372"><a href="#cb6-372" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> city_roads <span class="op">=</span> damaged_roads<span class="op">.</span><span class="fu">filterBounds</span>(cityAOI)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-373"><a href="#cb6-373" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-374"><a href="#cb6-374" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Calculate totals and proportions</span></span>
<span id="cb6-375"><a href="#cb6-375" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Get total building count for this city (by querying original building data)</span></span>
<span id="cb6-376"><a href="#cb6-376" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> total_city_buildings <span class="op">=</span> buildings<span class="op">.</span><span class="fu">filterBounds</span>(cityAOI)<span class="op">;</span></span>
<span id="cb6-377"><a href="#cb6-377" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> total_city_roads <span class="op">=</span> roads<span class="op">.</span><span class="fu">filterBounds</span>(cityAOI)<span class="op">;</span></span>
<span id="cb6-378"><a href="#cb6-378" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-379"><a href="#cb6-379" aria-hidden="true" tabindex="-1"></a>      <span class="co">// get data on damaged buildings and road</span></span>
<span id="cb6-380"><a href="#cb6-380" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> damaged_buildings_count <span class="op">=</span> city_buildings<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-381"><a href="#cb6-381" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> total_buildings_count <span class="op">=</span> total_city_buildings<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-382"><a href="#cb6-382" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> damaged_roads_count <span class="op">=</span> city_roads<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-383"><a href="#cb6-383" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> total_roads_count <span class="op">=</span> total_city_roads<span class="op">.</span><span class="fu">size</span>()<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-384"><a href="#cb6-384" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-385"><a href="#cb6-385" aria-hidden="true" tabindex="-1"></a>      <span class="co">// calculate the percentage of damaged buildings by subtype</span></span>
<span id="cb6-386"><a href="#cb6-386" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> buildings_percentage <span class="op">=</span> (damaged_buildings_count <span class="op">/</span> total_buildings_count <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb6-387"><a href="#cb6-387" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> roads_percentage <span class="op">=</span> (damaged_roads_count <span class="op">/</span> total_roads_count <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb6-388"><a href="#cb6-388" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> countsDict <span class="op">=</span> ee<span class="op">.</span><span class="fu">Dictionary</span>(city_buildings<span class="op">.</span><span class="fu">aggregate_histogram</span>(<span class="st">'subtype'</span>))<span class="op">;</span></span>
<span id="cb6-389"><a href="#cb6-389" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> subtypeTable <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(</span>
<span id="cb6-390"><a href="#cb6-390" aria-hidden="true" tabindex="-1"></a>        countsDict<span class="op">.</span><span class="fu">keys</span>()<span class="op">.</span><span class="fu">map</span>(<span class="kw">function</span>(k){</span>
<span id="cb6-391"><a href="#cb6-391" aria-hidden="true" tabindex="-1"></a>          k <span class="op">=</span> ee<span class="op">.</span><span class="fu">String</span>(k)<span class="op">;</span></span>
<span id="cb6-392"><a href="#cb6-392" aria-hidden="true" tabindex="-1"></a>          <span class="kw">var</span> n <span class="op">=</span> ee<span class="op">.</span><span class="fu">Number</span>(countsDict<span class="op">.</span><span class="fu">get</span>(k))<span class="op">;</span></span>
<span id="cb6-393"><a href="#cb6-393" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> ee<span class="op">.</span><span class="fu">Feature</span>(<span class="kw">null</span><span class="op">,</span> {</span>
<span id="cb6-394"><a href="#cb6-394" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span> <span class="op">:</span> k<span class="op">.</span><span class="fu">cat</span>(<span class="st">' ('</span>)<span class="op">.</span><span class="fu">cat</span>(n<span class="op">.</span><span class="fu">format</span>())<span class="op">.</span><span class="fu">cat</span>(<span class="st">')'</span>)<span class="op">,</span></span>
<span id="cb6-395"><a href="#cb6-395" aria-hidden="true" tabindex="-1"></a>            <span class="dt">count</span> <span class="op">:</span> n</span>
<span id="cb6-396"><a href="#cb6-396" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb6-397"><a href="#cb6-397" aria-hidden="true" tabindex="-1"></a>        }))<span class="op">;</span></span>
<span id="cb6-398"><a href="#cb6-398" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-399"><a href="#cb6-399" aria-hidden="true" tabindex="-1"></a>      <span class="co">// draw a piechart for damaged building subtype</span></span>
<span id="cb6-400"><a href="#cb6-400" aria-hidden="true" tabindex="-1"></a>      <span class="kw">var</span> damagePie <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">feature</span><span class="op">.</span><span class="fu">byFeature</span>(subtypeTable<span class="op">,</span> <span class="st">'label'</span><span class="op">,</span> [<span class="st">'count'</span>])<span class="op">.</span><span class="fu">setChartType</span>(<span class="st">'PieChart'</span>)</span>
<span id="cb6-401"><a href="#cb6-401" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">setOptions</span>({</span>
<span id="cb6-402"><a href="#cb6-402" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pieHole</span><span class="op">:</span> <span class="fl">0.4</span><span class="op">,</span></span>
<span id="cb6-403"><a href="#cb6-403" aria-hidden="true" tabindex="-1"></a>        <span class="dt">pieSliceText</span><span class="op">:</span> <span class="st">'lable'</span><span class="op">,</span></span>
<span id="cb6-404"><a href="#cb6-404" aria-hidden="true" tabindex="-1"></a>        <span class="dt">legend</span><span class="op">:</span> {<span class="dt">position</span><span class="op">:</span> <span class="st">'bottom'</span><span class="op">,</span></span>
<span id="cb6-405"><a href="#cb6-405" aria-hidden="true" tabindex="-1"></a>        <span class="dt">alignment</span><span class="op">:</span>  <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb6-406"><a href="#cb6-406" aria-hidden="true" tabindex="-1"></a>        <span class="dt">textStyle</span><span class="op">:</span>  {<span class="dt">fontSize</span><span class="op">:</span> <span class="dv">14</span>}<span class="op">,</span></span>
<span id="cb6-407"><a href="#cb6-407" aria-hidden="true" tabindex="-1"></a>        <span class="dt">maxLines</span><span class="op">:</span><span class="dv">3</span>}<span class="op">,</span></span>
<span id="cb6-408"><a href="#cb6-408" aria-hidden="true" tabindex="-1"></a>        <span class="dt">colors</span><span class="op">:</span>[<span class="st">'#0969a2'</span><span class="op">,</span><span class="st">'#ffc700'</span><span class="op">,</span><span class="st">'#ff4e40'</span><span class="op">,</span><span class="st">'#03436a'</span><span class="op">,</span><span class="st">'#ffe073'</span><span class="op">,</span><span class="st">'#ff1300'</span><span class="op">,</span><span class="st">'#245a7a'</span><span class="op">,</span><span class="st">'#ffd540'</span><span class="op">,</span></span>
<span id="cb6-409"><a href="#cb6-409" aria-hidden="true" tabindex="-1"></a>        <span class="st">'#d1b9c2'</span><span class="op">,</span><span class="st">'ff7d73'</span><span class="op">,</span><span class="st">'#64a8d1'</span><span class="op">,</span><span class="st">'bf3a30'</span>]</span>
<span id="cb6-410"><a href="#cb6-410" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb6-411"><a href="#cb6-411" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-412"><a href="#cb6-412" aria-hidden="true" tabindex="-1"></a>      <span class="co">// clear and display results</span></span>
<span id="cb6-413"><a href="#cb6-413" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb6-414"><a href="#cb6-414" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'City:  '</span><span class="op">,</span>{<span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span>}))<span class="op">;</span></span>
<span id="cb6-415"><a href="#cb6-415" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(selectedCity))<span class="op">;</span></span>
<span id="cb6-416"><a href="#cb6-416" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Time Period:'</span><span class="op">,</span>{<span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span>}))<span class="op">;</span></span>
<span id="cb6-417"><a href="#cb6-417" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'2022-02-24 to '</span> <span class="op">+</span> formattedEndDate))<span class="op">;</span></span>
<span id="cb6-418"><a href="#cb6-418" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Damaged Buildings: '</span><span class="op">,</span>{<span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span>}))<span class="op">;</span></span>
<span id="cb6-419"><a href="#cb6-419" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(damaged_buildings_count <span class="op">+</span> <span class="st">' out of '</span> <span class="op">+</span> total_buildings_count <span class="op">+</span> <span class="st">' ('</span> <span class="op">+</span> buildings_percentage <span class="op">+</span> <span class="st">'%)'</span>))<span class="op">;</span></span>
<span id="cb6-420"><a href="#cb6-420" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Damaged Roads: '</span><span class="op">,</span>{<span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span>}))<span class="op">;</span></span>
<span id="cb6-421"><a href="#cb6-421" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(damaged_roads_count <span class="op">+</span> <span class="st">' out of '</span> <span class="op">+</span> total_roads_count <span class="op">+</span> <span class="st">' ('</span> <span class="op">+</span> roads_percentage <span class="op">+</span> <span class="st">'%)'</span>))<span class="op">;</span></span>
<span id="cb6-422"><a href="#cb6-422" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Building damage statistics (by building type):'</span><span class="op">,</span>{<span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span>}))<span class="op">;</span></span>
<span id="cb6-423"><a href="#cb6-423" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(damagePie)<span class="op">;</span></span>
<span id="cb6-424"><a href="#cb6-424" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-425"><a href="#cb6-425" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (e) {</span>
<span id="cb6-426"><a href="#cb6-426" aria-hidden="true" tabindex="-1"></a>      <span class="co">// display error messages when errors occur</span></span>
<span id="cb6-427"><a href="#cb6-427" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">clear</span>()<span class="op">;</span></span>
<span id="cb6-428"><a href="#cb6-428" aria-hidden="true" tabindex="-1"></a>      resultsPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Error calculating results: '</span> <span class="op">+</span> e<span class="op">.</span><span class="at">message</span><span class="op">,</span> {</span>
<span id="cb6-429"><a href="#cb6-429" aria-hidden="true" tabindex="-1"></a>        <span class="dt">color</span><span class="op">:</span> <span class="st">'red'</span><span class="op">,</span></span>
<span id="cb6-430"><a href="#cb6-430" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span></span>
<span id="cb6-431"><a href="#cb6-431" aria-hidden="true" tabindex="-1"></a>      }))<span class="op">;</span></span>
<span id="cb6-432"><a href="#cb6-432" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="st">'Error in damage calculation:'</span><span class="op">,</span> e)<span class="op">;</span></span>
<span id="cb6-433"><a href="#cb6-433" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-434"><a href="#cb6-434" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-435"><a href="#cb6-435" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-436"><a href="#cb6-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-437"><a href="#cb6-437" aria-hidden="true" tabindex="-1"></a><span class="co">// Reanalyze with new POST_INTERVAL</span></span>
<span id="cb6-438"><a href="#cb6-438" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">reanalyzeWithNewInterval</span>() {</span>
<span id="cb6-439"><a href="#cb6-439" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Clear console</span></span>
<span id="cb6-440"><a href="#cb6-440" aria-hidden="true" tabindex="-1"></a>  <span class="co">//print('Reanalyzing: ' + POST_INTERVAL + ' months of war impact');</span></span>
<span id="cb6-441"><a href="#cb6-441" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-442"><a href="#cb6-442" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update date range</span></span>
<span id="cb6-443"><a href="#cb6-443" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> newDateRanges <span class="op">=</span> <span class="fu">updateDateRanges</span>()<span class="op">;</span></span>
<span id="cb6-444"><a href="#cb6-444" aria-hidden="true" tabindex="-1"></a>  startDate <span class="op">=</span> newDateRanges<span class="op">.</span><span class="at">startDate</span><span class="op">;</span></span>
<span id="cb6-445"><a href="#cb6-445" aria-hidden="true" tabindex="-1"></a>  endDate <span class="op">=</span> newDateRanges<span class="op">.</span><span class="at">endDate</span><span class="op">;</span></span>
<span id="cb6-446"><a href="#cb6-446" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-447"><a href="#cb6-447" aria-hidden="true" tabindex="-1"></a>  <span class="co">//print('Analysis period: from ' + startDate + ' to ' + endDate);</span></span>
<span id="cb6-448"><a href="#cb6-448" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-449"><a href="#cb6-449" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Clear existing layers on map</span></span>
<span id="cb6-450"><a href="#cb6-450" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="bu">Map</span><span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">length</span>() <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb6-451"><a href="#cb6-451" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Map</span><span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">remove</span>(<span class="bu">Map</span><span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">get</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-452"><a href="#cb6-452" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-453"><a href="#cb6-453" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-454"><a href="#cb6-454" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Recalculate building and road changes</span></span>
<span id="cb6-455"><a href="#cb6-455" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ascending_image <span class="op">=</span> <span class="fu">filter_s1</span>(<span class="st">"ASCENDING"</span>)<span class="op">;</span></span>
<span id="cb6-456"><a href="#cb6-456" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> descending_image <span class="op">=</span> <span class="fu">filter_s1</span>(<span class="st">"DESCENDING"</span>)<span class="op">;</span></span>
<span id="cb6-457"><a href="#cb6-457" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-458"><a href="#cb6-458" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> asc_des <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>([ascending_image<span class="op">,</span> descending_image])</span>
<span id="cb6-459"><a href="#cb6-459" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">median</span>()</span>
<span id="cb6-460"><a href="#cb6-460" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">clip</span>(aoi)<span class="op">;</span></span>
<span id="cb6-461"><a href="#cb6-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-462"><a href="#cb6-462" aria-hidden="true" tabindex="-1"></a><span class="co">// Add NDVI Mask</span></span>
<span id="cb6-463"><a href="#cb6-463" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> s2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">'COPERNICUS/S2_SR'</span>)</span>
<span id="cb6-464"><a href="#cb6-464" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filterDate</span>(startDate<span class="op">,</span> SHOCK_DATE)</span>
<span id="cb6-465"><a href="#cb6-465" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">filterBounds</span>(aoi)</span>
<span id="cb6-466"><a href="#cb6-466" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">select</span>([<span class="st">'B4'</span><span class="op">,</span><span class="st">'B8'</span>])</span>
<span id="cb6-467"><a href="#cb6-467" aria-hidden="true" tabindex="-1"></a><span class="op">.</span><span class="fu">median</span>()<span class="op">;</span></span>
<span id="cb6-468"><a href="#cb6-468" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi <span class="op">=</span> s2<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">'B8'</span><span class="op">,</span><span class="st">'B4'</span>])<span class="op">.</span><span class="fu">rename</span>(<span class="st">'NDVI'</span>)<span class="op">;</span></span>
<span id="cb6-469"><a href="#cb6-469" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi_mask <span class="op">=</span> ndvi<span class="op">.</span><span class="fu">gt</span>(<span class="fl">0.2</span>)<span class="op">;</span></span>
<span id="cb6-470"><a href="#cb6-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-471"><a href="#cb6-471" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate Composite Image</span></span>
<span id="cb6-472"><a href="#cb6-472" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> composite_image <span class="op">=</span> asc_des<span class="op">.</span><span class="fu">where</span>(ndvi_mask<span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb6-473"><a href="#cb6-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-474"><a href="#cb6-474" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Create building change mask (95% confidence)</span></span>
<span id="cb6-475"><a href="#cb6-475" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> threshold <span class="op">=</span> composite_image<span class="op">.</span><span class="fu">updateMask</span>(composite_image<span class="op">.</span><span class="fu">gt</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-476"><a href="#cb6-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-477"><a href="#cb6-477" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Analyze building changes</span></span>
<span id="cb6-478"><a href="#cb6-478" aria-hidden="true" tabindex="-1"></a>  damaged_building <span class="op">=</span> threshold<span class="op">.</span><span class="fu">reduceRegions</span>({</span>
<span id="cb6-479"><a href="#cb6-479" aria-hidden="true" tabindex="-1"></a>    <span class="dt">collection</span><span class="op">:</span> buildings<span class="op">,</span></span>
<span id="cb6-480"><a href="#cb6-480" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb6-481"><a href="#cb6-481" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb6-482"><a href="#cb6-482" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-483"><a href="#cb6-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-484"><a href="#cb6-484" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Analyze road changes</span></span>
<span id="cb6-485"><a href="#cb6-485" aria-hidden="true" tabindex="-1"></a>  damaged_roads <span class="op">=</span> threshold<span class="op">.</span><span class="fu">reduceRegions</span>({</span>
<span id="cb6-486"><a href="#cb6-486" aria-hidden="true" tabindex="-1"></a>    <span class="dt">collection</span><span class="op">:</span> roads<span class="op">,</span></span>
<span id="cb6-487"><a href="#cb6-487" aria-hidden="true" tabindex="-1"></a>    <span class="dt">reducer</span><span class="op">:</span> ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>()<span class="op">,</span></span>
<span id="cb6-488"><a href="#cb6-488" aria-hidden="true" tabindex="-1"></a>    <span class="dt">scale</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb6-489"><a href="#cb6-489" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-490"><a href="#cb6-490" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-491"><a href="#cb6-491" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Number of affected buildings and roads</span></span>
<span id="cb6-492"><a href="#cb6-492" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mariupol_buildings <span class="op">=</span> damaged_building<span class="op">.</span><span class="fu">filterBounds</span>(ukr1)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-493"><a href="#cb6-493" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> kharkiv_buildings <span class="op">=</span> damaged_building<span class="op">.</span><span class="fu">filterBounds</span>(ukr7)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-494"><a href="#cb6-494" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> total_buildings <span class="op">=</span> mariupol_buildings<span class="op">.</span><span class="fu">merge</span>(kharkiv_buildings)<span class="op">;</span></span>
<span id="cb6-495"><a href="#cb6-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-496"><a href="#cb6-496" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mariupol_roads <span class="op">=</span> damaged_roads<span class="op">.</span><span class="fu">filterBounds</span>(ukr1)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb6-497"><a href="#cb6-497" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> kharkiv_roads <span class="op">=</span> damaged_roads<span class="op">.</span><span class="fu">filterBounds</span>(ukr7)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="fl">0.5</span>))<span class="op">;</span></span>
<span id="cb6-498"><a href="#cb6-498" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> total_roads <span class="op">=</span> mariupol_roads<span class="op">.</span><span class="fu">merge</span>(kharkiv_roads)<span class="op">;</span></span>
<span id="cb6-499"><a href="#cb6-499" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-500"><a href="#cb6-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"mariupol - damaged buildings:"</span><span class="op">,</span> mariupol_buildings<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb6-501"><a href="#cb6-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"kharkiv - damaged buildings:"</span><span class="op">,</span> kharkiv_buildings<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb6-502"><a href="#cb6-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"total - damaged buildings:"</span><span class="op">,</span> total_buildings<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb6-503"><a href="#cb6-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"mariupol - damaged roads:"</span><span class="op">,</span> mariupol_roads<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb6-504"><a href="#cb6-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"kharkiv - damaged roads:"</span><span class="op">,</span> kharkiv_roads<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb6-505"><a href="#cb6-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"total - damaged roads:"</span><span class="op">,</span> total_roads<span class="op">.</span><span class="fu">size</span>())<span class="op">;</span></span>
<span id="cb6-506"><a href="#cb6-506" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-507"><a href="#cb6-507" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw building outlines</span></span>
<span id="cb6-508"><a href="#cb6-508" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> empty_buildings <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>()<span class="op">.</span><span class="fu">byte</span>()<span class="op">;</span></span>
<span id="cb6-509"><a href="#cb6-509" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> buildings_outline <span class="op">=</span> empty_buildings<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb6-510"><a href="#cb6-510" aria-hidden="true" tabindex="-1"></a>    <span class="dt">featureCollection</span><span class="op">:</span> damaged_building<span class="op">,</span></span>
<span id="cb6-511"><a href="#cb6-511" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"mean"</span><span class="op">,</span></span>
<span id="cb6-512"><a href="#cb6-512" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb6-513"><a href="#cb6-513" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-514"><a href="#cb6-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-515"><a href="#cb6-515" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Draw road outlines - add white border</span></span>
<span id="cb6-516"><a href="#cb6-516" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> empty_roads <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>()<span class="op">.</span><span class="fu">byte</span>()<span class="op">;</span></span>
<span id="cb6-517"><a href="#cb6-517" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> roads_white_outline <span class="op">=</span> empty_roads<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb6-518"><a href="#cb6-518" aria-hidden="true" tabindex="-1"></a>    <span class="dt">featureCollection</span><span class="op">:</span> damaged_roads<span class="op">,</span></span>
<span id="cb6-519"><a href="#cb6-519" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-520"><a href="#cb6-520" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">9</span></span>
<span id="cb6-521"><a href="#cb6-521" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-522"><a href="#cb6-522" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> roads_outline <span class="op">=</span> empty_roads<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb6-523"><a href="#cb6-523" aria-hidden="true" tabindex="-1"></a>    <span class="dt">featureCollection</span><span class="op">:</span> damaged_roads<span class="op">,</span></span>
<span id="cb6-524"><a href="#cb6-524" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">"mean"</span><span class="op">,</span></span>
<span id="cb6-525"><a href="#cb6-525" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb6-526"><a href="#cb6-526" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-527"><a href="#cb6-527" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-528"><a href="#cb6-528" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add layers</span></span>
<span id="cb6-529"><a href="#cb6-529" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-530"><a href="#cb6-530" aria-hidden="true" tabindex="-1"></a>    composite_image<span class="op">,</span></span>
<span id="cb6-531"><a href="#cb6-531" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette }<span class="op">,</span></span>
<span id="cb6-532"><a href="#cb6-532" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T-test Result"</span><span class="op">,</span></span>
<span id="cb6-533"><a href="#cb6-533" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span></span>
<span id="cb6-534"><a href="#cb6-534" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-535"><a href="#cb6-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-536"><a href="#cb6-536" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-537"><a href="#cb6-537" aria-hidden="true" tabindex="-1"></a>    buildings_outline<span class="op">,</span></span>
<span id="cb6-538"><a href="#cb6-538" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">palette</span><span class="op">:</span> building_palette<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="fl">0.6</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb6-539"><a href="#cb6-539" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Damaged Buildings"</span><span class="op">,</span></span>
<span id="cb6-540"><a href="#cb6-540" aria-hidden="true" tabindex="-1"></a>    <span class="kw">true</span></span>
<span id="cb6-541"><a href="#cb6-541" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-542"><a href="#cb6-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-543"><a href="#cb6-543" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-544"><a href="#cb6-544" aria-hidden="true" tabindex="-1"></a>    roads_white_outline<span class="op">,</span></span>
<span id="cb6-545"><a href="#cb6-545" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">palette</span><span class="op">:</span> [<span class="st">"ffffff"</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb6-546"><a href="#cb6-546" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Roads White Outline"</span><span class="op">,</span></span>
<span id="cb6-547"><a href="#cb6-547" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span></span>
<span id="cb6-548"><a href="#cb6-548" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-549"><a href="#cb6-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-550"><a href="#cb6-550" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-551"><a href="#cb6-551" aria-hidden="true" tabindex="-1"></a>    roads_outline<span class="op">,</span></span>
<span id="cb6-552"><a href="#cb6-552" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">palette</span><span class="op">:</span> building_palette<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="fl">0.6</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb6-553"><a href="#cb6-553" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Damaged Roads"</span><span class="op">,</span></span>
<span id="cb6-554"><a href="#cb6-554" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span></span>
<span id="cb6-555"><a href="#cb6-555" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-556"><a href="#cb6-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-557"><a href="#cb6-557" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add city boundary layer</span></span>
<span id="cb6-558"><a href="#cb6-558" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(cityBoundaries<span class="op">,</span> {}<span class="op">,</span> <span class="st">'adminboundaries'</span>)<span class="op">;</span></span>
<span id="cb6-559"><a href="#cb6-559" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-560"><a href="#cb6-560" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Restore layer visibility state</span></span>
<span id="cb6-561"><a href="#cb6-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateLayerVisibility</span>()<span class="op">;</span></span>
<span id="cb6-562"><a href="#cb6-562" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-563"><a href="#cb6-563" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Reset results panel</span></span>
<span id="cb6-564"><a href="#cb6-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateResultsPanel</span>()<span class="op">;</span></span>
<span id="cb6-565"><a href="#cb6-565" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-566"><a href="#cb6-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-567"><a href="#cb6-567" aria-hidden="true" tabindex="-1"></a><span class="co">// Update layer visibility state</span></span>
<span id="cb6-568"><a href="#cb6-568" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateLayerVisibility</span>() {</span>
<span id="cb6-569"><a href="#cb6-569" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set layer visibility based on checkbox state</span></span>
<span id="cb6-570"><a href="#cb6-570" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> buildingsLayer <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"Damaged Buildings"</span>)<span class="op">;</span></span>
<span id="cb6-571"><a href="#cb6-571" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (buildingsLayer) {</span>
<span id="cb6-572"><a href="#cb6-572" aria-hidden="true" tabindex="-1"></a>    buildingsLayer<span class="op">.</span><span class="fu">setShown</span>(buildingsCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-573"><a href="#cb6-573" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-574"><a href="#cb6-574" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-575"><a href="#cb6-575" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> whiteOutlineLayer <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"Roads White Outline"</span>)<span class="op">;</span></span>
<span id="cb6-576"><a href="#cb6-576" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> roadsLayer <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"Damaged Roads"</span>)<span class="op">;</span></span>
<span id="cb6-577"><a href="#cb6-577" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (whiteOutlineLayer <span class="op">&amp;&amp;</span> roadsLayer) {</span>
<span id="cb6-578"><a href="#cb6-578" aria-hidden="true" tabindex="-1"></a>    whiteOutlineLayer<span class="op">.</span><span class="fu">setShown</span>(roadsCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-579"><a href="#cb6-579" aria-hidden="true" tabindex="-1"></a>    roadsLayer<span class="op">.</span><span class="fu">setShown</span>(roadsCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-580"><a href="#cb6-580" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-581"><a href="#cb6-581" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-582"><a href="#cb6-582" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ttestLayer <span class="op">=</span> <span class="fu">getLayerByName</span>(<span class="st">"T-test Result"</span>)<span class="op">;</span></span>
<span id="cb6-583"><a href="#cb6-583" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ttestLayer) {</span>
<span id="cb6-584"><a href="#cb6-584" aria-hidden="true" tabindex="-1"></a>    ttestLayer<span class="op">.</span><span class="fu">setShown</span>(ttestCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-585"><a href="#cb6-585" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-586"><a href="#cb6-586" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-587"><a href="#cb6-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-588"><a href="#cb6-588" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------</span></span>
<span id="cb6-589"><a href="#cb6-589" aria-hidden="true" tabindex="-1"></a><span class="co">// Create download panel</span></span>
<span id="cb6-590"><a href="#cb6-590" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> downloadPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>({</span>
<span id="cb6-591"><a href="#cb6-591" aria-hidden="true" tabindex="-1"></a>  <span class="dt">layout</span><span class="op">:</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'vertical'</span>)<span class="op">,</span></span>
<span id="cb6-592"><a href="#cb6-592" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'5px 0'</span>}</span>
<span id="cb6-593"><a href="#cb6-593" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-594"><a href="#cb6-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-595"><a href="#cb6-595" aria-hidden="true" tabindex="-1"></a><span class="co">// Add download title</span></span>
<span id="cb6-596"><a href="#cb6-596" aria-hidden="true" tabindex="-1"></a>downloadPanel<span class="op">.</span><span class="fu">add</span>(ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Download Damage Buildings Data'</span><span class="op">,</span> {</span>
<span id="cb6-597"><a href="#cb6-597" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'16px'</span><span class="op">,</span></span>
<span id="cb6-598"><a href="#cb6-598" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span></span>
<span id="cb6-599"><a href="#cb6-599" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span>
<span id="cb6-600"><a href="#cb6-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-601"><a href="#cb6-601" aria-hidden="true" tabindex="-1"></a><span class="co">// Label for displaying download link</span></span>
<span id="cb6-602"><a href="#cb6-602" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> downloadUrlLabel <span class="op">=</span> ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">' '</span><span class="op">,</span>{</span>
<span id="cb6-603"><a href="#cb6-603" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span></span>
<span id="cb6-604"><a href="#cb6-604" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-605"><a href="#cb6-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-606"><a href="#cb6-606" aria-hidden="true" tabindex="-1"></a><span class="co">// Create download button</span></span>
<span id="cb6-607"><a href="#cb6-607" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> downloadButton <span class="op">=</span> ui<span class="op">.</span><span class="fu">Button</span>({</span>
<span id="cb6-608"><a href="#cb6-608" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">'Get Download Link'</span><span class="op">,</span></span>
<span id="cb6-609"><a href="#cb6-609" aria-hidden="true" tabindex="-1"></a>  <span class="dt">onClick</span><span class="op">:</span> <span class="kw">function</span>() {</span>
<span id="cb6-610"><a href="#cb6-610" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get currently selected city</span></span>
<span id="cb6-611"><a href="#cb6-611" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> selectedCity <span class="op">=</span> citySelect<span class="op">.</span><span class="fu">getValue</span>()<span class="op">;</span></span>
<span id="cb6-612"><a href="#cb6-612" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-613"><a href="#cb6-613" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get corresponding AOI based on selected city</span></span>
<span id="cb6-614"><a href="#cb6-614" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> cityAOI<span class="op">;</span></span>
<span id="cb6-615"><a href="#cb6-615" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (selectedCity <span class="op">===</span> <span class="st">'Mariupol'</span>) {</span>
<span id="cb6-616"><a href="#cb6-616" aria-hidden="true" tabindex="-1"></a>      cityAOI <span class="op">=</span> ukr1<span class="op">;</span></span>
<span id="cb6-617"><a href="#cb6-617" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (selectedCity <span class="op">===</span> <span class="st">'Kharkiv'</span>) {</span>
<span id="cb6-618"><a href="#cb6-618" aria-hidden="true" tabindex="-1"></a>      cityAOI <span class="op">=</span> ukr7<span class="op">;</span></span>
<span id="cb6-619"><a href="#cb6-619" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-620"><a href="#cb6-620" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-621"><a href="#cb6-621" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Filter damaged buildings for current city</span></span>
<span id="cb6-622"><a href="#cb6-622" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> city_buildings <span class="op">=</span> damaged_building<span class="op">.</span><span class="fu">filterBounds</span>(cityAOI)<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">gt</span>(<span class="st">"mean"</span><span class="op">,</span> <span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-623"><a href="#cb6-623" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-624"><a href="#cb6-624" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Generate current date-time string as part of filename</span></span>
<span id="cb6-625"><a href="#cb6-625" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> filename <span class="op">=</span> selectedCity <span class="op">+</span> <span class="st">'_damaged_buildings_'</span> <span class="op">+</span> ee<span class="op">.</span><span class="fu">Date</span>(SHOCK_DATE)<span class="op">.</span><span class="fu">advance</span>(POST_INTERVAL<span class="op">,</span> <span class="st">"month"</span>)<span class="op">.</span><span class="fu">format</span>(<span class="st">'YYYY-MM-dd'</span>)<span class="op">.</span><span class="fu">getInfo</span>()<span class="op">;</span></span>
<span id="cb6-626"><a href="#cb6-626" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-627"><a href="#cb6-627" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get download link</span></span>
<span id="cb6-628"><a href="#cb6-628" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> url <span class="op">=</span> city_buildings<span class="op">.</span><span class="fu">getDownloadURL</span>({</span>
<span id="cb6-629"><a href="#cb6-629" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> <span class="st">'GeoJSON'</span><span class="op">,</span></span>
<span id="cb6-630"><a href="#cb6-630" aria-hidden="true" tabindex="-1"></a>      <span class="dt">filename</span><span class="op">:</span> filename</span>
<span id="cb6-631"><a href="#cb6-631" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb6-632"><a href="#cb6-632" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-633"><a href="#cb6-633" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update download link label</span></span>
<span id="cb6-634"><a href="#cb6-634" aria-hidden="true" tabindex="-1"></a>    downloadUrlLabel<span class="op">.</span><span class="fu">setUrl</span>(url)<span class="op">;</span></span>
<span id="cb6-635"><a href="#cb6-635" aria-hidden="true" tabindex="-1"></a>    downloadUrlLabel<span class="op">.</span><span class="fu">setValue</span>(<span class="st">'Download Link'</span>)<span class="op">;</span></span>
<span id="cb6-636"><a href="#cb6-636" aria-hidden="true" tabindex="-1"></a>    downloadUrlLabel<span class="op">.</span><span class="fu">style</span>()<span class="op">.</span><span class="fu">set</span>({</span>
<span id="cb6-637"><a href="#cb6-637" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'13px'</span><span class="op">,</span></span>
<span id="cb6-638"><a href="#cb6-638" aria-hidden="true" tabindex="-1"></a>      <span class="dt">color</span><span class="op">:</span> <span class="st">'blue'</span><span class="op">,</span></span>
<span id="cb6-639"><a href="#cb6-639" aria-hidden="true" tabindex="-1"></a>      <span class="dt">textDecoration</span><span class="op">:</span> <span class="st">'underline'</span></span>
<span id="cb6-640"><a href="#cb6-640" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb6-641"><a href="#cb6-641" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb6-642"><a href="#cb6-642" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {</span>
<span id="cb6-643"><a href="#cb6-643" aria-hidden="true" tabindex="-1"></a>    <span class="dt">stretch</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span></span>
<span id="cb6-644"><a href="#cb6-644" aria-hidden="true" tabindex="-1"></a>    <span class="dt">textAlign</span><span class="op">:</span> <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb6-645"><a href="#cb6-645" aria-hidden="true" tabindex="-1"></a>    <span class="dt">margin</span><span class="op">:</span> <span class="st">'5px 0'</span></span>
<span id="cb6-646"><a href="#cb6-646" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-647"><a href="#cb6-647" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-648"><a href="#cb6-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-649"><a href="#cb6-649" aria-hidden="true" tabindex="-1"></a><span class="co">// Add download button to download panel</span></span>
<span id="cb6-650"><a href="#cb6-650" aria-hidden="true" tabindex="-1"></a>downloadPanel<span class="op">.</span><span class="fu">add</span>(downloadButton)<span class="op">;</span></span>
<span id="cb6-651"><a href="#cb6-651" aria-hidden="true" tabindex="-1"></a>downloadPanel<span class="op">.</span><span class="fu">add</span>(downloadUrlLabel)<span class="op">;</span></span>
<span id="cb6-652"><a href="#cb6-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-653"><a href="#cb6-653" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------</span></span>
<span id="cb6-654"><a href="#cb6-654" aria-hidden="true" tabindex="-1"></a><span class="co">// Credit panel</span></span>
<span id="cb6-655"><a href="#cb6-655" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> creditsNotes <span class="op">=</span> ui<span class="op">.</span><span class="fu">Panel</span>([</span>
<span id="cb6-656"><a href="#cb6-656" aria-hidden="true" tabindex="-1"></a>  ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Credits:'</span><span class="op">,</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'12px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'8px 8px 1px 8px'</span><span class="op">,</span> <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">'bold'</span>})<span class="op">,</span></span>
<span id="cb6-657"><a href="#cb6-657" aria-hidden="true" tabindex="-1"></a>  ui<span class="op">.</span><span class="fu">Panel</span>([</span>
<span id="cb6-658"><a href="#cb6-658" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'• Data source: '</span><span class="op">,</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'12px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 8px 8px 8px'</span>})<span class="op">,</span></span>
<span id="cb6-659"><a href="#cb6-659" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Sentinel-1'</span><span class="op">,</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'12px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 8px 8px 0px'</span>}<span class="op">,</span> <span class="st">'https://sentiwiki.copernicus.eu/web/s1-mission'</span>)</span>
<span id="cb6-660"><a href="#cb6-660" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'horizontal'</span>)<span class="op">,</span> {<span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 0px 0px 0px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 0px 0px 0px'</span>})<span class="op">,</span></span>
<span id="cb6-661"><a href="#cb6-661" aria-hidden="true" tabindex="-1"></a>  ui<span class="op">.</span><span class="fu">Panel</span>([</span>
<span id="cb6-662"><a href="#cb6-662" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'• Building Footprints: '</span><span class="op">,</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'12px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 8px 8px 8px'</span>})<span class="op">,</span></span>
<span id="cb6-663"><a href="#cb6-663" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'Overture Maps Foundation'</span><span class="op">,</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'12px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 8px 8px 0px'</span>}<span class="op">,</span> <span class="st">'https://overturemaps.org/'</span>)</span>
<span id="cb6-664"><a href="#cb6-664" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'horizontal'</span>)<span class="op">,</span> {<span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 0px 0px 0px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 0px 0px 0px'</span>})<span class="op">,</span></span>
<span id="cb6-665"><a href="#cb6-665" aria-hidden="true" tabindex="-1"></a>  ui<span class="op">.</span><span class="fu">Panel</span>([</span>
<span id="cb6-666"><a href="#cb6-666" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'• Road Network: '</span><span class="op">,</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'12px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 8px 8px 8px'</span>})<span class="op">,</span></span>
<span id="cb6-667"><a href="#cb6-667" aria-hidden="true" tabindex="-1"></a>    ui<span class="op">.</span><span class="fu">Label</span>(<span class="st">'OSM'</span><span class="op">,</span> {<span class="dt">fontSize</span><span class="op">:</span> <span class="st">'12px'</span><span class="op">,</span> <span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 8px 8px 0px'</span>}<span class="op">,</span> <span class="st">'https://www.openstreetmap.org/'</span>)</span>
<span id="cb6-668"><a href="#cb6-668" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span> ui<span class="op">.</span><span class="at">Panel</span><span class="op">.</span><span class="at">Layout</span><span class="op">.</span><span class="fu">flow</span>(<span class="st">'horizontal'</span>)<span class="op">,</span> {<span class="dt">margin</span><span class="op">:</span> <span class="st">'0px 0px 0px 0px'</span><span class="op">,</span> <span class="dt">padding</span><span class="op">:</span> <span class="st">'0px 0px 0px 0px'</span>})</span>
<span id="cb6-669"><a href="#cb6-669" aria-hidden="true" tabindex="-1"></a>])<span class="op">;</span></span>
<span id="cb6-670"><a href="#cb6-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-671"><a href="#cb6-671" aria-hidden="true" tabindex="-1"></a><span class="co">// Add all panels to left control panel</span></span>
<span id="cb6-672"><a href="#cb6-672" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(titlePanel)<span class="op">;</span></span>
<span id="cb6-673"><a href="#cb6-673" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(lineBreak)<span class="op">;</span></span>
<span id="cb6-674"><a href="#cb6-674" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(cityPanel)<span class="op">;</span></span>
<span id="cb6-675"><a href="#cb6-675" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(timePanel)<span class="op">;</span></span>
<span id="cb6-676"><a href="#cb6-676" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(layerPanel)<span class="op">;</span></span>
<span id="cb6-677"><a href="#cb6-677" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(assessPanel)<span class="op">;</span></span>
<span id="cb6-678"><a href="#cb6-678" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(downloadPanel)<span class="op">;</span></span>
<span id="cb6-679"><a href="#cb6-679" aria-hidden="true" tabindex="-1"></a>leftPanel<span class="op">.</span><span class="fu">add</span>(creditsNotes)<span class="op">;</span></span>
<span id="cb6-680"><a href="#cb6-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-681"><a href="#cb6-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-682"><a href="#cb6-682" aria-hidden="true" tabindex="-1"></a><span class="co">// Hide zoom button in top-left corner of map</span></span>
<span id="cb6-683"><a href="#cb6-683" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">setControlVisibility</span>({<span class="dt">zoomControl</span><span class="op">:</span> <span class="kw">false</span>})<span class="op">;</span></span>
<span id="cb6-684"><a href="#cb6-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-685"><a href="#cb6-685" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------</span></span>
<span id="cb6-686"><a href="#cb6-686" aria-hidden="true" tabindex="-1"></a><span class="co">// Comparison slider functionality</span></span>
<span id="cb6-687"><a href="#cb6-687" aria-hidden="true" tabindex="-1"></a><span class="co">// Create two map instances</span></span>
<span id="cb6-688"><a href="#cb6-688" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> leftMap <span class="op">=</span> ui<span class="op">.</span><span class="fu">Map</span>()<span class="op">;</span>  <span class="co">// Left map, showing analysis results</span></span>
<span id="cb6-689"><a href="#cb6-689" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> rightMap <span class="op">=</span> ui<span class="op">.</span><span class="fu">Map</span>()<span class="op">;</span>  <span class="co">// Right map, showing satellite imagery</span></span>
<span id="cb6-690"><a href="#cb6-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-691"><a href="#cb6-691" aria-hidden="true" tabindex="-1"></a><span class="co">// Add left control panel to left map</span></span>
<span id="cb6-692"><a href="#cb6-692" aria-hidden="true" tabindex="-1"></a>leftMap<span class="op">.</span><span class="fu">add</span>(leftPanel)<span class="op">;</span></span>
<span id="cb6-693"><a href="#cb6-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-694"><a href="#cb6-694" aria-hidden="true" tabindex="-1"></a><span class="co">// Set left map layers - copy all layers from original Map to leftMap</span></span>
<span id="cb6-695"><a href="#cb6-695" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">copyLayersToLeftMap</span>() {</span>
<span id="cb6-696"><a href="#cb6-696" aria-hidden="true" tabindex="-1"></a>  <span class="co">// First clear existing layers on leftMap</span></span>
<span id="cb6-697"><a href="#cb6-697" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (leftMap<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">length</span>() <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb6-698"><a href="#cb6-698" aria-hidden="true" tabindex="-1"></a>    leftMap<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">remove</span>(leftMap<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">get</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-699"><a href="#cb6-699" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-700"><a href="#cb6-700" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-701"><a href="#cb6-701" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add building change layer</span></span>
<span id="cb6-702"><a href="#cb6-702" aria-hidden="true" tabindex="-1"></a>  leftMap<span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-703"><a href="#cb6-703" aria-hidden="true" tabindex="-1"></a>    composite_image<span class="op">,</span></span>
<span id="cb6-704"><a href="#cb6-704" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span> <span class="dt">palette</span><span class="op">:</span> palette }<span class="op">,</span></span>
<span id="cb6-705"><a href="#cb6-705" aria-hidden="true" tabindex="-1"></a>    <span class="st">"T-test Result"</span><span class="op">,</span></span>
<span id="cb6-706"><a href="#cb6-706" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span>  <span class="co">// Not displayed by default</span></span>
<span id="cb6-707"><a href="#cb6-707" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-708"><a href="#cb6-708" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-709"><a href="#cb6-709" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add building outline layer</span></span>
<span id="cb6-710"><a href="#cb6-710" aria-hidden="true" tabindex="-1"></a>  leftMap<span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-711"><a href="#cb6-711" aria-hidden="true" tabindex="-1"></a>    buildings_outline<span class="op">,</span></span>
<span id="cb6-712"><a href="#cb6-712" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">palette</span><span class="op">:</span> building_palette<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="fl">0.6</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb6-713"><a href="#cb6-713" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Damaged Buildings"</span><span class="op">,</span></span>
<span id="cb6-714"><a href="#cb6-714" aria-hidden="true" tabindex="-1"></a>    <span class="kw">true</span>  <span class="co">// Displayed by default</span></span>
<span id="cb6-715"><a href="#cb6-715" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-716"><a href="#cb6-716" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-717"><a href="#cb6-717" aria-hidden="true" tabindex="-1"></a>  <span class="co">// First add white border layer</span></span>
<span id="cb6-718"><a href="#cb6-718" aria-hidden="true" tabindex="-1"></a>  leftMap<span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-719"><a href="#cb6-719" aria-hidden="true" tabindex="-1"></a>    roads_white_outline<span class="op">,</span></span>
<span id="cb6-720"><a href="#cb6-720" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">palette</span><span class="op">:</span> [<span class="st">"ffffff"</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span> }<span class="op">,</span></span>
<span id="cb6-721"><a href="#cb6-721" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Roads White Outline"</span><span class="op">,</span></span>
<span id="cb6-722"><a href="#cb6-722" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span>  <span class="co">// Not displayed by default</span></span>
<span id="cb6-723"><a href="#cb6-723" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-724"><a href="#cb6-724" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-725"><a href="#cb6-725" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Then add colored road layer</span></span>
<span id="cb6-726"><a href="#cb6-726" aria-hidden="true" tabindex="-1"></a>  leftMap<span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-727"><a href="#cb6-727" aria-hidden="true" tabindex="-1"></a>    roads_outline<span class="op">,</span></span>
<span id="cb6-728"><a href="#cb6-728" aria-hidden="true" tabindex="-1"></a>    { <span class="dt">palette</span><span class="op">:</span> building_palette<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="fl">0.6</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2</span> }<span class="op">,</span></span>
<span id="cb6-729"><a href="#cb6-729" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Damaged Roads"</span><span class="op">,</span></span>
<span id="cb6-730"><a href="#cb6-730" aria-hidden="true" tabindex="-1"></a>    <span class="kw">false</span>  <span class="co">// Not displayed by default</span></span>
<span id="cb6-731"><a href="#cb6-731" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-732"><a href="#cb6-732" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-733"><a href="#cb6-733" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add city boundary layer</span></span>
<span id="cb6-734"><a href="#cb6-734" aria-hidden="true" tabindex="-1"></a>  leftMap<span class="op">.</span><span class="fu">addLayer</span>(cityBoundaries<span class="op">,</span> {}<span class="op">,</span> <span class="st">'adminboundaries'</span>)<span class="op">;</span></span>
<span id="cb6-735"><a href="#cb6-735" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-736"><a href="#cb6-736" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Restore layer visibility state</span></span>
<span id="cb6-737"><a href="#cb6-737" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateLeftMapLayerVisibility</span>()<span class="op">;</span></span>
<span id="cb6-738"><a href="#cb6-738" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-739"><a href="#cb6-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-740"><a href="#cb6-740" aria-hidden="true" tabindex="-1"></a><span class="co">// Update left map layer visibility</span></span>
<span id="cb6-741"><a href="#cb6-741" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">updateLeftMapLayerVisibility</span>() {</span>
<span id="cb6-742"><a href="#cb6-742" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set layer visibility based on checkbox state</span></span>
<span id="cb6-743"><a href="#cb6-743" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> buildingsLayer <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"Damaged Buildings"</span>)<span class="op">;</span></span>
<span id="cb6-744"><a href="#cb6-744" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (buildingsLayer) {</span>
<span id="cb6-745"><a href="#cb6-745" aria-hidden="true" tabindex="-1"></a>    buildingsLayer<span class="op">.</span><span class="fu">setShown</span>(buildingsCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-746"><a href="#cb6-746" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-747"><a href="#cb6-747" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-748"><a href="#cb6-748" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> whiteOutlineLayer <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"Roads White Outline"</span>)<span class="op">;</span></span>
<span id="cb6-749"><a href="#cb6-749" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> roadsLayer <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"Damaged Roads"</span>)<span class="op">;</span></span>
<span id="cb6-750"><a href="#cb6-750" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (whiteOutlineLayer <span class="op">&amp;&amp;</span> roadsLayer) {</span>
<span id="cb6-751"><a href="#cb6-751" aria-hidden="true" tabindex="-1"></a>    whiteOutlineLayer<span class="op">.</span><span class="fu">setShown</span>(roadsCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-752"><a href="#cb6-752" aria-hidden="true" tabindex="-1"></a>    roadsLayer<span class="op">.</span><span class="fu">setShown</span>(roadsCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-753"><a href="#cb6-753" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-754"><a href="#cb6-754" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-755"><a href="#cb6-755" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ttestLayer <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"T-test Result"</span>)<span class="op">;</span></span>
<span id="cb6-756"><a href="#cb6-756" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ttestLayer) {</span>
<span id="cb6-757"><a href="#cb6-757" aria-hidden="true" tabindex="-1"></a>    ttestLayer<span class="op">.</span><span class="fu">setShown</span>(ttestCheckbox<span class="op">.</span><span class="fu">getValue</span>())<span class="op">;</span></span>
<span id="cb6-758"><a href="#cb6-758" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-759"><a href="#cb6-759" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-760"><a href="#cb6-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-761"><a href="#cb6-761" aria-hidden="true" tabindex="-1"></a><span class="co">// Get left map specific layer name</span></span>
<span id="cb6-762"><a href="#cb6-762" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getLeftMapLayerByName</span>(name) {</span>
<span id="cb6-763"><a href="#cb6-763" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> layers <span class="op">=</span> leftMap<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">getJsArray</span>()<span class="op">;</span></span>
<span id="cb6-764"><a href="#cb6-764" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> layers<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb6-765"><a href="#cb6-765" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (layers[i]<span class="op">.</span><span class="fu">getName</span>() <span class="op">===</span> name) {</span>
<span id="cb6-766"><a href="#cb6-766" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> layers[i]<span class="op">;</span></span>
<span id="cb6-767"><a href="#cb6-767" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-768"><a href="#cb6-768" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-769"><a href="#cb6-769" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb6-770"><a href="#cb6-770" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-771"><a href="#cb6-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-772"><a href="#cb6-772" aria-hidden="true" tabindex="-1"></a><span class="co">// Set right map layers - show satellite imagery</span></span>
<span id="cb6-773"><a href="#cb6-773" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">setRightMapLayers</span>() {</span>
<span id="cb6-774"><a href="#cb6-774" aria-hidden="true" tabindex="-1"></a>  <span class="co">// First clear existing layers on rightMap</span></span>
<span id="cb6-775"><a href="#cb6-775" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (rightMap<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">length</span>() <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb6-776"><a href="#cb6-776" aria-hidden="true" tabindex="-1"></a>    rightMap<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">remove</span>(rightMap<span class="op">.</span><span class="fu">layers</span>()<span class="op">.</span><span class="fu">get</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb6-777"><a href="#cb6-777" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-778"><a href="#cb6-778" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-779"><a href="#cb6-779" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Set satellite base map</span></span>
<span id="cb6-780"><a href="#cb6-780" aria-hidden="true" tabindex="-1"></a>  rightMap<span class="op">.</span><span class="fu">setOptions</span>(<span class="st">'HYBRID'</span>)<span class="op">;</span></span>
<span id="cb6-781"><a href="#cb6-781" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-782"><a href="#cb6-782" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Add building footprint (white outline)</span></span>
<span id="cb6-783"><a href="#cb6-783" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> emptyBuildings <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>()<span class="op">.</span><span class="fu">byte</span>()<span class="op">;</span></span>
<span id="cb6-784"><a href="#cb6-784" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> buildingsOutlineWhite <span class="op">=</span> emptyBuildings<span class="op">.</span><span class="fu">paint</span>({</span>
<span id="cb6-785"><a href="#cb6-785" aria-hidden="true" tabindex="-1"></a>    <span class="dt">featureCollection</span><span class="op">:</span> damaged_building<span class="op">,</span></span>
<span id="cb6-786"><a href="#cb6-786" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb6-787"><a href="#cb6-787" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb6-788"><a href="#cb6-788" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb6-789"><a href="#cb6-789" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-790"><a href="#cb6-790" aria-hidden="true" tabindex="-1"></a>  rightMap<span class="op">.</span><span class="fu">addLayer</span>(</span>
<span id="cb6-791"><a href="#cb6-791" aria-hidden="true" tabindex="-1"></a>    buildingsOutlineWhite<span class="op">,</span></span>
<span id="cb6-792"><a href="#cb6-792" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">palette</span><span class="op">:</span> [<span class="st">'white'</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">opacity</span><span class="op">:</span> <span class="fl">0.7</span>}<span class="op">,</span></span>
<span id="cb6-793"><a href="#cb6-793" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Buildings Footprint'</span><span class="op">,</span></span>
<span id="cb6-794"><a href="#cb6-794" aria-hidden="true" tabindex="-1"></a>    <span class="kw">true</span></span>
<span id="cb6-795"><a href="#cb6-795" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb6-796"><a href="#cb6-796" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-797"><a href="#cb6-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-798"><a href="#cb6-798" aria-hidden="true" tabindex="-1"></a><span class="co">// Initialize left and right maps</span></span>
<span id="cb6-799"><a href="#cb6-799" aria-hidden="true" tabindex="-1"></a><span class="fu">copyLayersToLeftMap</span>()<span class="op">;</span></span>
<span id="cb6-800"><a href="#cb6-800" aria-hidden="true" tabindex="-1"></a><span class="fu">setRightMapLayers</span>()<span class="op">;</span></span>
<span id="cb6-801"><a href="#cb6-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-802"><a href="#cb6-802" aria-hidden="true" tabindex="-1"></a><span class="co">// Set initial center position</span></span>
<span id="cb6-803"><a href="#cb6-803" aria-hidden="true" tabindex="-1"></a>leftMap<span class="op">.</span><span class="fu">centerObject</span>(mariupolCenter<span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb6-804"><a href="#cb6-804" aria-hidden="true" tabindex="-1"></a>rightMap<span class="op">.</span><span class="fu">centerObject</span>(mariupolCenter<span class="op">,</span> <span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb6-805"><a href="#cb6-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-806"><a href="#cb6-806" aria-hidden="true" tabindex="-1"></a><span class="co">// Create map linker to synchronize two maps</span></span>
<span id="cb6-807"><a href="#cb6-807" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> linker <span class="op">=</span> ui<span class="op">.</span><span class="at">Map</span><span class="op">.</span><span class="fu">Linker</span>([leftMap<span class="op">,</span> rightMap])<span class="op">;</span></span>
<span id="cb6-808"><a href="#cb6-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-809"><a href="#cb6-809" aria-hidden="true" tabindex="-1"></a><span class="co">// Modify city selection dropdown onChange event, update both maps</span></span>
<span id="cb6-810"><a href="#cb6-810" aria-hidden="true" tabindex="-1"></a>citySelect<span class="op">.</span><span class="fu">onChange</span>(<span class="kw">function</span>(value) {</span>
<span id="cb6-811"><a href="#cb6-811" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Get current city center</span></span>
<span id="cb6-812"><a href="#cb6-812" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cityCenter<span class="op">;</span></span>
<span id="cb6-813"><a href="#cb6-813" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> zoomLevel<span class="op">;</span></span>
<span id="cb6-814"><a href="#cb6-814" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-815"><a href="#cb6-815" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (value <span class="op">===</span> <span class="st">'Kharkiv'</span>) {</span>
<span id="cb6-816"><a href="#cb6-816" aria-hidden="true" tabindex="-1"></a>    cityCenter <span class="op">=</span> kharkivCenter<span class="op">;</span></span>
<span id="cb6-817"><a href="#cb6-817" aria-hidden="true" tabindex="-1"></a>    zoomLevel <span class="op">=</span> <span class="dv">13</span><span class="op">;</span></span>
<span id="cb6-818"><a href="#cb6-818" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co">// Mariupol</span></span>
<span id="cb6-819"><a href="#cb6-819" aria-hidden="true" tabindex="-1"></a>    cityCenter <span class="op">=</span> mariupolCenter<span class="op">;</span></span>
<span id="cb6-820"><a href="#cb6-820" aria-hidden="true" tabindex="-1"></a>    zoomLevel <span class="op">=</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb6-821"><a href="#cb6-821" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-822"><a href="#cb6-822" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-823"><a href="#cb6-823" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update center position of both maps</span></span>
<span id="cb6-824"><a href="#cb6-824" aria-hidden="true" tabindex="-1"></a>  leftMap<span class="op">.</span><span class="fu">centerObject</span>(cityCenter<span class="op">,</span> zoomLevel)<span class="op">;</span></span>
<span id="cb6-825"><a href="#cb6-825" aria-hidden="true" tabindex="-1"></a>  rightMap<span class="op">.</span><span class="fu">centerObject</span>(cityCenter<span class="op">,</span> zoomLevel)<span class="op">;</span></span>
<span id="cb6-826"><a href="#cb6-826" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-827"><a href="#cb6-827" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update right map</span></span>
<span id="cb6-828"><a href="#cb6-828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setRightMapLayers</span>()<span class="op">;</span></span>
<span id="cb6-829"><a href="#cb6-829" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-830"><a href="#cb6-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-831"><a href="#cb6-831" aria-hidden="true" tabindex="-1"></a><span class="co">// Modify layer checkbox onChange event to update left map</span></span>
<span id="cb6-832"><a href="#cb6-832" aria-hidden="true" tabindex="-1"></a>buildingsCheckbox<span class="op">.</span><span class="fu">onChange</span>(<span class="kw">function</span>(isChecked) {</span>
<span id="cb6-833"><a href="#cb6-833" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> layer <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"Damaged Buildings"</span>)<span class="op">;</span></span>
<span id="cb6-834"><a href="#cb6-834" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (layer) {</span>
<span id="cb6-835"><a href="#cb6-835" aria-hidden="true" tabindex="-1"></a>    layer<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-836"><a href="#cb6-836" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-837"><a href="#cb6-837" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-838"><a href="#cb6-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-839"><a href="#cb6-839" aria-hidden="true" tabindex="-1"></a>roadsCheckbox<span class="op">.</span><span class="fu">onChange</span>(<span class="kw">function</span>(isChecked) {</span>
<span id="cb6-840"><a href="#cb6-840" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> whiteOutline <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"Roads White Outline"</span>)<span class="op">;</span></span>
<span id="cb6-841"><a href="#cb6-841" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> roads <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"Damaged Roads"</span>)<span class="op">;</span></span>
<span id="cb6-842"><a href="#cb6-842" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-843"><a href="#cb6-843" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (whiteOutline) {</span>
<span id="cb6-844"><a href="#cb6-844" aria-hidden="true" tabindex="-1"></a>    whiteOutline<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-845"><a href="#cb6-845" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-846"><a href="#cb6-846" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-847"><a href="#cb6-847" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (roads) {</span>
<span id="cb6-848"><a href="#cb6-848" aria-hidden="true" tabindex="-1"></a>    roads<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-849"><a href="#cb6-849" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-850"><a href="#cb6-850" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-851"><a href="#cb6-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-852"><a href="#cb6-852" aria-hidden="true" tabindex="-1"></a>ttestCheckbox<span class="op">.</span><span class="fu">onChange</span>(<span class="kw">function</span>(isChecked) {</span>
<span id="cb6-853"><a href="#cb6-853" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> layer <span class="op">=</span> <span class="fu">getLeftMapLayerByName</span>(<span class="st">"T-test Result"</span>)<span class="op">;</span></span>
<span id="cb6-854"><a href="#cb6-854" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (layer) {</span>
<span id="cb6-855"><a href="#cb6-855" aria-hidden="true" tabindex="-1"></a>    layer<span class="op">.</span><span class="fu">setShown</span>(isChecked)<span class="op">;</span></span>
<span id="cb6-856"><a href="#cb6-856" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-857"><a href="#cb6-857" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-858"><a href="#cb6-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-859"><a href="#cb6-859" aria-hidden="true" tabindex="-1"></a><span class="co">// Create split panel</span></span>
<span id="cb6-860"><a href="#cb6-860" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> splitPanel <span class="op">=</span> ui<span class="op">.</span><span class="fu">SplitPanel</span>({</span>
<span id="cb6-861"><a href="#cb6-861" aria-hidden="true" tabindex="-1"></a>  <span class="dt">firstPanel</span><span class="op">:</span> leftMap<span class="op">,</span></span>
<span id="cb6-862"><a href="#cb6-862" aria-hidden="true" tabindex="-1"></a>  <span class="dt">secondPanel</span><span class="op">:</span> rightMap<span class="op">,</span></span>
<span id="cb6-863"><a href="#cb6-863" aria-hidden="true" tabindex="-1"></a>  <span class="dt">orientation</span><span class="op">:</span> <span class="st">'horizontal'</span><span class="op">,</span></span>
<span id="cb6-864"><a href="#cb6-864" aria-hidden="true" tabindex="-1"></a>  <span class="dt">wipe</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb6-865"><a href="#cb6-865" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> {<span class="dt">stretch</span><span class="op">:</span> <span class="st">'both'</span>}</span>
<span id="cb6-866"><a href="#cb6-866" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb6-867"><a href="#cb6-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-868"><a href="#cb6-868" aria-hidden="true" tabindex="-1"></a><span class="co">// Add split panel to UI root widget</span></span>
<span id="cb6-869"><a href="#cb6-869" aria-hidden="true" tabindex="-1"></a>ui<span class="op">.</span><span class="at">root</span><span class="op">.</span><span class="fu">widgets</span>()<span class="op">.</span><span class="fu">reset</span>([splitPanel])<span class="op">;</span></span>
<span id="cb6-870"><a href="#cb6-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-871"><a href="#cb6-871" aria-hidden="true" tabindex="-1"></a><span class="co">// ensure that each initialization starts from 2022-3-24</span></span>
<span id="cb6-872"><a href="#cb6-872" aria-hidden="true" tabindex="-1"></a><span class="fu">reanalyzeWithNewInterval</span>()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="reference" class="level2">
<h2 class="anchored" data-anchor-id="reference">Reference</h2>
<p>Ballinger, O. (2024). 9 Blast Damage Assessment (WWW) London: CASA (https://github.com/oballinger/CASA0025/; 12 Mar 2024).</p>
<p>Dietrich, O., Peters, T., Sainte Fare Garnot, V. and others (2025). An open-source tool for mapping war destruction at scale in Ukraine using Sentinel-1 time series, Communications Earth &amp; Environment, 6, 215. Available at: https://doi.org/10.1038/s43247-025-02183-7 [Accessed 27 April 2025].</p>
<p>USGS (2018). NDVI: The Foundation of Remote Sensing Phenology. [online] Available at: https://www.usgs.gov/special-topics/remote-sensing-phenology/science/ndvi-foundation-remote-sensing-phenology [Accessed 27 April 2025].</p>
<p>Wang, X. and Li, P. (2020) Extraction of urban building damage using spectral, height and corner information from VHR satellite images and airborne LiDAR data, ISPRS Journal of Photogrammetry and Remote Sensing, 159.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>